<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Lynx Apartment Host Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 40px;
        background: #f9f9f9;
      }
      h1 {
        text-align: center;
      }
      .tabs {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 20px;
        border-bottom: 2px solid #eee;
        gap: 0;
      }
      .tab-btn {
        background: none;
        border: none;
        outline: none;
        padding: 12px 24px;
        font-size: 16px;
        cursor: pointer;
        border-bottom: 3px solid #ccc;
        transition: border 0.2s, color 0.2s;
        white-space: nowrap;
        flex: 1 1 auto;
        text-align: center;
        min-width: 120px;
        max-width: 100vw;
      }
      .tab-btn.active {
        border-bottom: 3px solid #0078d7;
        color: #0078d7;
        font-weight: bold;
      }
      .tab-content {
        display: none;
      }
      .tab-content.active {
        display: block;
      }
      .section {
        margin-bottom: 30px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input[type="text"] {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
      }
      .checkbox-group {
        margin-left: 20px;
      }
      .checkbox-group label {
        font-weight: normal;
        display: block;
        margin-bottom: 5px;
      }
      button {
        padding: 10px 20px;
        margin-top: 20px;
      }
      .add-btn {
        margin-top: 10px;
        font-size: 12px;
      }
      img.logo {
        display: block;
        margin: auto;
        width: 100px;
      }
      @media screen and (max-width: 600px) {
        .tabs {
          flex-direction: row;
          flex-wrap: wrap;
        }
        .tab-btn {
          font-size: 15px;
          padding: 10px 8px;
          min-width: 100px;
        }
        .checkbox-group label {
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 5px 0;
        }
        .checkbox-group input[type="checkbox"] {
          margin-right: 10px;
        }
      }
      body.dark-mode {
        background: #23272a;
        color: #f3f3f3;
      }
      body.dark-mode h1,
      body.dark-mode label {
        color: #f3f3f3;
      }
      body.dark-mode .container {
        background: #23272a;
      }
      body.dark-mode .tab-btn.active {
        color: #ffe066;
        border-bottom: 3px solid #ffe066;
      }
      body.dark-mode .tab-content {
        background: transparent;
      }
      body.dark-mode button,
      body.dark-mode .add-btn {
        background: #23272a;
        color: #ffe066;
        border: 1px solid #ffe066;
      }
      body.dark-mode input[type="text"] {
        background: #23272a;
        color: #f3f3f3;
        border: 1px solid #444;
      }
      body.dark-mode .checkbox-group label {
        color: #f3f3f3;
      }
      body.dark-mode #shopping-list li {
        color: #f3f3f3;
      }
      body.dark-mode select {
        background: #23272a;
        color: #f3f3f3;
        border: 1px solid #444;
      }
      body.dark-mode .tab-btn {
        border: none; /* —Å–ø—Ä–µ—á—É–≤–∞ –Ω–µ—Å–∞–∫–∞–µ–Ω –æ–∫–≤–∏—Ä */
        border-bottom: 3px solid #444; /* —Å–∞–º–æ –¥–æ–ª–Ω–∏–æ—Ç —Ä–∞–± –∞–∫–æ —Å–∞–∫–∞—Ç–µ */
        background: transparent;
      }
      /* --- Responsive Top Bar for Date & Theme Toggle --- */
      .top-bar {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 12px;
        margin-bottom: 20px;
        padding: 0 16px;
        position: relative;
      }
      .top-bar label {
        margin: 0;
        font-weight: 600;
        font-size: 1rem;
        white-space: nowrap;
        margin-right: 8px;
      }
      .top-bar select {
        width: fit-content;
        font-size: 1rem;
        padding: 6px 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
        background: #fff;
        color: #23272a;
        margin: 0 8px;
      }
      #theme-toggle {
        position: absolute;
        top: 16px;
        right: 16px;
        font-size: 1.5rem;
        background: none;
        border: none;
        cursor: pointer;
        border-radius: 4px;
        padding: 4px 8px;
      }
      .top-bar button#theme-toggle {
        font-size: 1.6em;
        background: none;
        border: none;
        cursor: pointer;
        border-radius: 50%;
        padding: 6px 10px;
        transition: background 0.2s;
        margin: 0;
      }
      .top-bar button#theme-toggle:active,
      .top-bar button#theme-toggle:focus {
        background: #eee;
        outline: none;
      }

      @media (max-width: 600px) {
        .top-bar {
          flex-direction: column;
          align-items: stretch;
          gap: 8px;
          padding: 12px;
        }
        .top-bar label,
        .top-bar select,
        .top-bar button#theme-toggle {
          font-size: 1.08em;
          width: 100%;
          margin: 0;
          text-align: center;
        }

        .top-bar button#theme-toggle {
          align-self: flex-end;
          width: auto;
        }
      }
      body.dark-mode .top-bar select {
        width: fit-content;
        background: #23272a;
        color: #f3f3f3;
        border: 1px solid #444;
      }
      body.dark-mode .top-bar button#theme-toggle:active,
      body.dark-mode .top-bar button#theme-toggle:focus {
        background: #333;
      }
      #theme-toggle {
        position: absolute;
        top: 16px;
        right: 16px;
        font-size: 1.5rem;
        background: #f0f0f0;
        color: #222;
        border: 1px solid #ccc;
        border-radius: 8px;
        padding: 6px 10px;
        cursor: pointer;
        z-index: 1000;
      }
      body.dark-mode #theme-toggle {
        background: #23272a;
        color: #ffe066;
        border-color: #23272a;
      }
      #theme-toggle:hover {
        background: transparent;
      }
      .date-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
      }
      .date-wrapper select {
        width: fit-content;
        padding: 6px 10px;
        font-size: 1rem;
        margin-bottom: 16px;
        border-color: #cbd2d7;
      }

      .date-row select {
        width: fit-content;
        min-width: auto;
        padding: 6px 10px;
        font-size: 1rem;
      }
      body.dark-mode .date-wrapper select {
        background: #23272a;
        color: #f3f3f3;
        border: 1px solid #444;
        width: fit-content;
        margin-bottom: 16px;
      }
      /* New styles for enhanced UI */
      .sticky-tabs {
        position: sticky;
        top: 0;
        background: #fff;
        z-index: 1000;
        padding: 10px 0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      body.dark-mode .sticky-tabs {
        background: #23272a;
      }
      .accordion {
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-bottom: 10px;
      }
      .accordion-header {
        background: #f5f5f5;
        padding: 12px 15px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-radius: 4px;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      .accordion-header:hover {
        background: #eee;
      }
      .accordion-content {
        padding: 15px;
        display: none;
      }
      .accordion.active .accordion-content {
        display: block;
      }
      .progress-bar {
        height: 4px;
        background: #eee;
        border-radius: 2px;
        margin: 5px 0;
      }
      .progress-fill {
        height: 100%;
        background: #0078d7;
        border-radius: 2px;
        transition: width 0.3s ease;
      }
      .search-container {
        margin: 20px 0;
        position: relative;
        width: fit-content;
        margin: 0 auto 20px auto;
      }
      .search-input {
        width: 200px;
        padding: 10px 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 16px;
      }
      .priority-badge {
        display: inline-block;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 12px;
        margin-left: 8px;
      }
      .priority-high {
        background: #ffebee;
        color: #c62828;
      }
      .priority-medium {
        background: #fff3e0;
        color: #ef6c00;
      }
      .priority-low {
        background: #e8f5e9;
        color: #2e7d32;
      }
      .item-metadata {
        font-size: 12px;
        color: #666;
        margin-left: 8px;
      }
      .view-all-btn {
        background: none;
        border: none;
        color: #0078d7;
        cursor: pointer;
        padding: 5px 10px;
        font-size: 14px;
      }
      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }
      .section-stats {
        font-size: 14px;
        color: #666;
      }
      /* Dark mode adjustments */
      body.dark-mode .accordion-header {
        background: #2c2f33;
        color: #fff;
      }
      body.dark-mode .accordion-header:hover {
        background: #36393f;
      }
      body.dark-mode .search-input {
        background: #2c2f33;
        color: #fff;
        border-color: #444;
      }
      body.dark-mode .priority-badge {
        opacity: 0.9;
      }
      body.dark-mode .item-metadata {
        color: #aaa;
      }
      body.dark-mode .view-all-btn {
        color: #ffe066;
      }
      body.dark-mode .section-stats {
        color: #aaa;
      }
      /* Mobile optimizations */
      @media screen and (max-width: 600px) {
        body {
          margin: 20px 10px;
        }
        .accordion-header {
          padding: 10px;
        }
        .search-input {
          font-size: 16px; /* Prevents zoom on iOS */
        }
        .priority-badge {
          font-size: 11px;
        }
      }
      /* Make checkboxes more touch-friendly */
      .checkbox-group input[type="checkbox"] {
        width: 20px;
        height: 20px;
        margin-right: 10px;
        cursor: pointer;
      }
      .checkbox-group label {
        padding: 8px 0;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
      }

      .toast {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #28a745; /* –ó–µ–ª–µ–Ω–∞ –±–æ—ò–∞ –∑–∞ —É—Å–ø–µ—à–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—ò–∞ */
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 14px;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.5s, visibility 0.5s ease-in-out;
        z-index: 9999;
      }

      .toast.show {
        opacity: 1;
        visibility: visible;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <button id="theme-toggle" aria-label="Toggle dark mode">üåô</button>

      <div class="date-wrapper">
        <label for="date">–î–∞—Ç—É–º –Ω–∞ –∏–Ω—Å–ø–µ–∫—Ü–∏—ò–∞:</label>
        <select id="date"></select>
      </div>

      <img src="logo-lynx.png" alt="Lynx Logo" class="logo" id="lynx-logo" />
      <h1>Lynx Apartment Dashboard</h1>

      <!-- Search Container -->
      <div class="search-container">
        <input type="text" class="search-input" id="search-input" placeholder="Search items..." />
      </div>

      <!-- Sticky Tabs -->
      <nav class="tabs sticky-tabs" role="tablist">
        <button
          class="tab-btn active"
          id="tab-checklist"
          role="tab"
          aria-selected="true"
          aria-controls="content-checklist"
          tabindex="0"
        >
          –ß–∏—Å—Ç–µ—ö–µ
        </button>
        <button
          class="tab-btn"
          id="tab-consumables"
          role="tab"
          aria-selected="false"
          aria-controls="content-consumables"
          tabindex="-1"
        >
          –ü–æ—Ç—Ä–æ—à–∞–Ω –ú–∞—Ç–µ—Ä–∏—ò–∞–ª
        </button>
        <button
          class="tab-btn"
          id="tab-inventory"
          role="tab"
          aria-selected="false"
          aria-controls="content-inventory"
          tabindex="-1"
        >
          –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞
        </button>
        <button
          class="tab-btn"
          id="tab-shopping"
          role="tab"
          aria-selected="false"
          aria-controls="content-shopping"
          tabindex="-1"
        >
          –®–æ–ø–∏–Ω–≥ –ª–∏—Å—Ç–∞
        </button>
      </nav>

      <!-- Cleaning List Section -->
      <div
        id="content-checklist"
        class="tab-content active"
        role="tabpanel"
        aria-labelledby="tab-checklist"
      >
        <div id="checklist-sections">
          <!-- Cleaning checklist items will be rendered here -->
        </div>
        <div class="section">
          <label>Additional Notes</label>
          <input type="text" id="notes" placeholder="Any extra details..." />
        </div>
      </div>
      <!-- Consumables List Section -->
      <div
        id="content-consumables"
        class="tab-content"
        role="tabpanel"
        aria-labelledby="tab-consumables"
      >
        <div id="consumables-sections"><!-- Consumables items rendered here --></div>
      </div>
      <!-- Inventory List Section -->
      <div
        id="content-inventory"
        class="tab-content"
        role="tabpanel"
        aria-labelledby="tab-inventory"
      >
        <div id="inventory-sections"><!-- Inventory items rendered here --></div>
      </div>
      <!-- Shopping List Section -->
      <div id="content-shopping" class="tab-content" role="tabpanel" aria-labelledby="tab-shopping">
        <div class="section">
          <ul
            id="shopping-list"
            class="checkbox-group"
            style="list-style: none; padding-left: 0"
          ></ul>
          <button class="add-btn" onclick="addShoppingItem()">+ –î–æ–¥–∞–¥–∏ —Å—Ç–∞–≤–∫–∞</button>
        </div>
      </div>
      <!-- Global Save Checklist Button -->
      <div style="text-align: center; margin: 32px 0 0 0">
        <button id="save-checklist-global" onclick="saveChecklist()">–ó–∞—á—É–≤–∞—ò –ª–∏—Å—Ç–∞</button>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="DejaVuSans-normal.js"></script>
    <script>
      // --- Tab Switching & Theme Logic ---
      const tabBtns = document.querySelectorAll(".tab-btn");
      const tabContents = document.querySelectorAll(".tab-content");

      // Track active tab
      let activeTab = "tab-checklist"; // Default to Cleaning tab

      tabBtns.forEach((btn, idx) => {
        btn.addEventListener("click", function () {
          tabBtns.forEach(b => b.classList.remove("active"));
          tabContents.forEach(c => c.classList.remove("active"));
          btn.classList.add("active");
          tabContents[idx].classList.add("active");

          // Update active tab
          activeTab = btn.id; // Store the current active tab
          updateAddToShoppingBtnVisibility(); // Call function to update button visibility

          btn.setAttribute("aria-selected", "true");
          btn.setAttribute("tabindex", "0");
          tabBtns.forEach((b, i) => {
            if (i !== idx) {
              b.setAttribute("aria-selected", "false");
              b.setAttribute("tabindex", "-1");
            }
          });
        });
      });

      function updateAddToShoppingBtnVisibility() {
        // Hide all "Add to Shopping" buttons initially
        const addToShoppingBtns = document.querySelectorAll(".add-to-shopping-btn");
        addToShoppingBtns.forEach(btn => {
          btn.style.display = "none"; // Hide button by default
        });

        // Show the buttons only in the "tab-inventory" tab
        if (activeTab === "tab-consumables") {
          const inventoryBtns = document.querySelectorAll(".add-to-shopping-btn");
          inventoryBtns.forEach(btn => {
            btn.style.display = "inline-block"; // Show button in inventory tab
          });
        }
      }

      // --- Dark Mode Logic ---
      const themeToggle = document.getElementById("theme-toggle");
      const logoImg = document.getElementById("lynx-logo");
      function setTheme(dark) {
        if (dark) {
          document.body.classList.add("dark-mode");
          themeToggle.textContent = "‚òÄÔ∏è";
          logoImg.src = "logo-lynx-dark.png";
          localStorage.setItem("lynx-theme", "dark");
        } else {
          document.body.classList.remove("dark-mode");
          themeToggle.textContent = "üåô";
          logoImg.src = "logo-lynx.png";
          localStorage.setItem("lynx-theme", "light");
        }
      }
      themeToggle.onclick = function () {
        setTheme(!document.body.classList.contains("dark-mode"));
      };
      (function () {
        const saved = localStorage.getItem("lynx-theme");
        setTheme(saved === "dark");
      })();

      // --- Enhanced Section Grouping & Metadata ---
      // Define metadata for items (priority, estimated time, frequency)
      const itemMetadata = {
        // Example: '–û—Ç–≤–æ—Ä–∏ –≤—Ä–∞—Ç–∞ - –ø—Ä–æ–≤–µ—Ç—Ä–∏': { priority: 'high', time: 1, frequency: 'every stay' }
      };
      // Grouped sections for accordions
      const CleaningGroups = [
        {
          group: "–°–æ–±–∏",
          sections: ["–û–ø—à—Ç–æ", "–°–ø–∞–ª–Ω–∞", "–î–Ω–µ–≤–Ω–∞"],
        },
        {
          group: "–ö—É—ò–Ω–∞",
          sections: ["–ö—É—ò–Ω–∞", "–¢—Ä–ø–µ–∑–∞—Ä–∏—ò–∞"],
        },
        {
          group: "–ö—É–ø–∞—Ç–∏–ª–æ",
          sections: ["–ö—É–ø–∞—Ç–∏–ª–æ"],
        },
        {
          group: "–û—Å—Ç–∞–Ω–∞—Ç–æ",
          sections: ["–¢–µ—Ä–∞—Å–∞", "–•–æ–¥–Ω–∏–∫"],
        },
      ];
      // --- Cleaning List Logic (refactored for accordions, progress, view all) ---
      const CleaningSections = {
        –û–ø—à—Ç–æ: [
          "–ü—Ä–æ–≤–µ—Ç—Ä–∏ - –æ—Ç–≤–æ—Ä–∏ –≤—Ä–∞—Ç–∞",
          "–°–æ–±–µ—Ä–∏ –ø–æ—Å—Ç–µ–ª–Ω–∏–Ω–∞ –∏ –∫—Ä–ø–µ (—Å–ø–∞–ª–Ω–∞, –∫—É—ò–Ω–∞, WC)",
          "–°–æ–±–µ—Ä–∏ —ì—É–±—Ä–µ (–∫—É—ò–Ω–∞ –∏ WC)",
          "–ò—Å—Ç—Ä–µ—Å–∏ –ø—Ä–µ–∫—Ä–∏–≤–∞—á–∏/–∫–µ–±–∏—ö–∞/—ò–∞—Å—Ç—É—Ü–∏ (–¥–Ω–µ–≤–Ω–∞/—Å–ø–∞–ª–Ω–∞)",
          "–£—Å–∏—Å–∞—ò —Ç–µ–ø–∏—Å–∏, –ø–æ–¥–æ–≤–∏, –≥–∞—Ä–Ω–∏—Ç—É—Ä–∞, —Å—Ç–æ–ª–∏—Ü–µ",
          "–ò–∑–±—Ä–∏—à–∏ –ø—Ä–∞—à–∏–Ω–∞ –æ–¥ –ø–æ–≤—Ä—à–∏–Ω–∏",
          "–ò–∑—ü–æ–≥–∏—Ä–∞—ò –ø–æ–¥",
          "–ü—Ä–æ–≤–µ—Ä–∏ –¥–∞ –Ω–µ–º–∞ –∑–∞–±–æ—Ä–∞–≤–µ–Ω–∏ –ø—Ä–µ–¥–º–µ—Ç–∏/—Ö—Ä–∞–Ω–∞",
          "–ò—Å—á–∏—Å—Ç–∏ –ø—Ä–µ–∫–∏–¥–∞—á–∏ –∑–∞ —Å–≤–µ—Ç–ª–∞ –∏ —Ä—É—á–∫–µ –Ω–∞ –≤—Ä–∞—Ç–∞",
          "–ü—Ä–æ–≤–µ—Ä–∏ —Å–∏—Ç–µ —Ñ–∏–æ–∫–∏ –∏ –≤–∏—Å–∞—ú–∏",
        ],
        –°–ø–∞–ª–Ω–∞: [
          "–ò–∑–±—Ä–∏—à–∏ –ø—Ä–∞—à–∏–Ω–∞ –æ–¥ –Ω–æ—ú–Ω–∏ –æ—Ä–º–∞—Ä–∏/–ª–∞–º–ø–µ/–¢–í",
          "–ü—Ä–æ–≤–µ—Ä–∏ –¢–í –∏ –¥–∞–ª–µ—á–∏–Ω—Å–∫–∏",
          "–ò–∑–±—Ä–∏—à–∏ –ø—Ä–∞—à–∏–Ω–∞ –≤–æ –≥–∞—Ä–¥–µ—Ä–æ–±–µ—Ä",
          "–ü—Ä–æ–≤–µ—Ä–∏ –∫—Ä–µ–≤–µ—Ç –∏ –¥—É—à–µ–∫",
          "–ü—Ä–æ–≤–µ—Ä–∏ —Ä–µ–∑–µ—Ä–≤–Ω–∞ –ø–æ—Å—Ç–µ–ª–Ω–∏–Ω–∞ –ø–æ–¥ –∫—Ä–µ–≤–µ—Ç",
        ],
        –î–Ω–µ–≤–Ω–∞: [
          "–ò–∑–±—Ä–∏—à–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∏ –¢–í, –¥–∞–ª–µ—á–∏–Ω—Å–∫–∏ –∏ –∫–æ–º–æ–¥—É",
          "–ò–∑–±—Ä–∏—à–∏ –ø—Ä–∞—à–∏–Ω–∞ –æ–¥ –º–∏–Ω–∏–±–∞—Ä",
          "–ò–∑–±—Ä–∏—à–∏ –ø—Ä–∞—à–∏–Ω–∞ –æ–¥ –õ—É—Å—Ç–µ—Ä/–°—Ç–æ–ª–Ω–∞ –õ–∞–º–ø–∞",
          "–ü—Ä–æ–≤–µ—Ä–∏ sofa bed",
          "–ù–∞–≤–æ–¥–Ω–∏ —Ü–≤–µ—ú–µ",
          "–ü—Ä–æ–≤–µ—Ä–∏ WiFi –±—Ä–∑–∏–Ω–∞",
          "–ü—Ä–æ–≤–µ—Ä–∏ –∫–Ω–∏–≥–∏ –∑–∞ –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞ (3)",
        ],
        –ö—É—ò–Ω–∞: [
          "–ò–∑–±—Ä–∏—à–∏ —à–ø–æ—Ä–µ—Ç –∏ —Ä–µ—Ä–Ω—É",
          "–ò—Å–ø—Ä–∞–∑–Ω–∏ –∏ –ò–∑–±—Ä–∏—à–∏ —Ñ—Ä–∏–∂–∏–¥–µ—Ä –∏ –∑–∞–º—Ä–∑–Ω—É–≤–∞—á",
          "–ò—Å–ø—Ä–∞–∑–Ω–∏ –∏ –ò–∑–±—Ä–∏—à–∏ –º–∞—à–∏–Ω–∞ –∑–∞ –∫–∞—Ñ–µ",
          "–ò–∑–±—Ä–∏—à–∏ –º–∏–∫—Ä–æ–±—Ä–∞–Ω–æ–≤–∞ –ø–µ—á–∫–∞",
          "–ü—Ä–æ–≤–µ—Ä–∏ –º–∞—à–∏–Ω–∞ –∑–∞ —Å–∞–¥–æ–≤–∏",
          "–ò—Å—á–∏—Å—Ç–∏ –µ–ª–µ–∫—Ç—Ä–∏—á–µ–Ω –±–æ–∫–∞–ª",
          "–ò—Å–ø—Ä–∞–∑–Ω–∏ —Ç–æ—Å—Ç–µ—Ä –æ–¥ —Ç—Ä–æ—à–∫–µ",
          "–ü—Ä–æ–≤–µ—Ä–∏ —Ç–µ–Ω—ü–µ—Ä–∏—ö–∞ –∏ —Ç–∞–≤–∏",
          "–ò–∑–±—Ä–∏—à–∏ –ø—Ä–∏–±–æ—Ä –∑–∞ —ò–∞–¥–µ—ö–µ",
          "–ò–∑–±—Ä–∏—à–∏ —Å—Ç–∞–∫–ª–µ–Ω–∫–∏ —á–∞—à–∏",
          "–ò–∑–±—Ä–∏—à–∏ –¥–∞—Å–∫–∏ –∑–∞ —Å–µ—á–µ—ö–µ",
          "–î–æ–ø–æ–ª–Ω–∏ —á–∞—ò/–∫–∞—Ñ–µ/–±–æ–º–±–æ–Ω–µ/–≤–æ–¥–∞",
          "–î–æ–ø–æ–ª–Ω–∏ –∫–µ—Å–µ –∑–∞ —ì—É–±—Ä–µ",
        ],
        –ö—É–ø–∞—Ç–∏–ª–æ: [
          "–ò—Å—á–∏—Å—Ç–∏ –æ–≥–ª–µ–¥–∞–ª–æ –∏ –ª–∞–≤–∞–±–æ",
          "–ò—Å—á–∏—Å—Ç–∏ —Ç—É—à –∫–∞–±–∏–Ω–∞ –∏ —Ç—É—à —Ä—É—á–∫–∞",
          "–ò—Å—á–∏—Å—Ç–∏ –í–¶ —à–æ—ô–∞ –∏ –ß–µ—Ç–∫–∞ –∑–∞ –í–¶ —à–æ—ô–∞",
          "–ò–∑—ü–æ–≥–∏—Ä–∞—ò –ø–æ–¥ –∏ –ø–ª–æ—á–∫–∏",
          "–î–æ–ø–æ–ª–Ω–∏ —Ç–æ–∞–ª–µ—Ç–Ω–∞ —Ö–∞—Ä—Ç–∏—ò–∞",
          "–î–æ–ø–æ–ª–Ω–∏ —Ç–µ—á–µ–Ω —Å–∞–ø—É–Ω–Ω",
          "–î–æ–ø–æ–ª–Ω–∏ —Å—Ä–µ–¥—Å—Ç–≤–æ –∑–∞ –ø–µ—Ä–µ—ö–µ –∞–ª–∏—à—Ç–∞",
          "–î–æ–ø–æ–ª–Ω–∏ —Å—Ä–µ–¥—Å—Ç–≤–æ –∑–∞ –¥–µ–∑–∏–Ω—Ñ–µ–∫—Ü–∏—ò–∞",
          "–ó–∞–º–µ–Ω–∏ –æ—Å–≤–µ–∂–∏–≤–∞—á –∑–∞ –í–¶ —à–æ—ô–∞",
          "–°—Ç–∞–≤–∏ –Ω–æ–≤–∏ –∫—Ä–ø–∏ (–∫–∞–ø–µ—ö–µ, –ª–∏—Ü–µ, –Ω–æ–≥–µ) (2 –ø–æ –≥–æ—Å—Ç–∞)",
          "–ü—Ä–æ–≤–µ—Ä–∏ —Ñ–µ–Ω, –º–∞—à–∏–Ω–∞ –∑–∞ –ø—Ä–∞—ö–µ, –±–æ—ò–ª–µ—Ä, —Å—É—à–∞—Ä–∞",
        ],
        –¢—Ä–ø–µ–∑–∞—Ä–∏—ò–∞: [
          "–ü—Ä–µ–±—Ä–∏—à–∏ —Ç—Ä–ø–µ–∑–∞—Ä–∏—Å–∫–∏ –∞—Å—Ç–∞–ª",
          "–ò—Å—Ç—Ä–µ—Å–∏ —Å—Ç–æ–ª–∏—Ü–∏ –æ–¥ —Ç—Ä–æ—à–∫–∏",
          "–ù–∞–º–µ—Å—Ç–∏ –ø–æ–¥–ª–æ–≥–∏ –∑–∞ –≤—Ä—É—ú–æ",
          "–°—Ç–∞–≤–∏ –≤–∞–∑–Ω—É –Ω–∞ —Å—Ä–µ–¥ —Å—Ç–∞–ª",
        ],
        –¢–µ—Ä–∞—Å–∞: ["–ò–∑–º–∏—ò —Ç–µ—Ä–∞—Å–∞", "–ü—Ä–µ–±—Ä–∏—à–∏ –∞—Å—Ç–∞–ª—á–µ –∏ —Å—Ç–æ–ª–∏—Ü–∏"],
        –•–æ–¥–Ω–∏–∫: ["–ü—Ä–µ–±—Ä–∏—à–∏ –ø–ª–∞–∫–∞—Ä", "–ü—Ä–µ–±—Ä–∏—à–∏ –û–≥–ª–µ–¥–∞–ª–æ"],
      };
      // Save/load checked state to localStorage
      function getCheckedState(section) {
        return JSON.parse(localStorage.getItem("checked_" + section) || "[]");
      }
      function setCheckedState(section, arr) {
        localStorage.setItem("checked_" + section, JSON.stringify(arr));
      }
      // Section with progress bar
      function renderSectionWithProgress(title, items, sectionKey, onProgressChange) {
        const sectionDiv = document.createElement("div");
        sectionDiv.className = "section";

        // Section header
        const header = document.createElement("div");
        header.className = "section-header";
        header.innerHTML = `<label>${title}</label>`;
        sectionDiv.appendChild(header);

        // Items list
        const ul = document.createElement("div");
        ul.className = "checkbox-group section-items";

        // Load checked state from localStorage
        let checkedArr = JSON.parse(localStorage.getItem("checked_" + sectionKey) || "[]");
        if (!Array.isArray(checkedArr) || checkedArr.length !== items.length) {
          checkedArr = Array(items.length).fill(false);
        }

        items.forEach((item, idx) => {
          const label = document.createElement("label");
          label.style.display = "flex";
          label.style.alignItems = "center";
          label.style.justifyContent = "space-between";
          // Fix: Always display correct item text
          let displayText = "";
          if (typeof item === "string") {
            displayText = item;
          } else if (item && typeof item === "object") {
            displayText = item.text || item.name || JSON.stringify(item);
          }

          // Conditionally add the "add-to-shopping-btn" button
          const addToShoppingBtn =
            activeTab === "tab-consumables"
              ? `<button class="add-to-shopping-btn" data-item="${item}" onclick="addToShoppingList('${item}')">üõí</button>`
              : "";

          label.innerHTML = `<span><input type="checkbox" data-section="${sectionKey}" data-idx="${idx}"> ${displayText}</span>`;
          const checkbox = label.querySelector("input[type='checkbox']");
          checkbox.checked = checkedArr[idx];
          checkbox.onchange = function () {
            checkedArr[idx] = checkbox.checked;
            localStorage.setItem("checked_" + sectionKey, JSON.stringify(checkedArr));
            if (onProgressChange) {
              onProgressChange();
            }
          };
          ul.appendChild(label);
        });

        sectionDiv.appendChild(ul);

        // Make header clickable for collapse/expand
        header.onclick = function (e) {
          if (e.target.tagName === "INPUT") return;
          ul.style.display = ul.style.display === "none" ? "block" : "none";
        };

        return sectionDiv;
      }

      // Accordion rendering
      function renderCleaningAccordions() {
        const container = document.getElementById("checklist-sections");
        container.innerHTML = "";

        // Add collapse/expand all button
        const controlsDiv = document.createElement("div");
        controlsDiv.className = "section-controls";
        controlsDiv.innerHTML = `
          <button class="view-all-btn" onclick="toggleAllSections(true)">Expand All</button>
          <button class="view-all-btn" onclick="toggleAllSections(false)">Collapse All</button>
        `;
        container.appendChild(controlsDiv);

        CleaningGroups.forEach(groupObj => {
          const acc = document.createElement("div");
          acc.className = "accordion";

          const header = document.createElement("div");
          header.className = "accordion-header";

          // Calculate total items and completed items for this group
          let totalItems = 0;
          let completedItems = 0;
          groupObj.sections.forEach(section => {
            const items = CleaningSections[section];
            totalItems += items.length;
            const checkedArr = JSON.parse(localStorage.getItem("checked_" + section) || "[]");
            if (Array.isArray(checkedArr)) {
              completedItems += checkedArr.filter(Boolean).length;
            }
          });

          header.innerHTML = `
            <span>${groupObj.group}</span>
            <span class="section-stats">${completedItems}/${totalItems} –∑–∞–≤—Ä—à–µ–Ω–æ</span>
          `;
          acc.appendChild(header);

          const content = document.createElement("div");
          content.className = "accordion-content";

          groupObj.sections.forEach(section => {
            content.appendChild(
              renderSectionWithProgress(section, CleaningSections[section], section, () => {
                // Update group progress when any item changes
                let newTotal = 0;
                let newCompleted = 0;
                groupObj.sections.forEach(s => {
                  const items = CleaningSections[s];
                  newTotal += items.length;
                  const checkedArr = JSON.parse(localStorage.getItem("checked_" + s) || "[]");
                  if (Array.isArray(checkedArr)) {
                    newCompleted += checkedArr.filter(Boolean).length;
                  }
                });
                header.querySelector(
                  ".section-stats"
                ).textContent = `${newCompleted}/${newTotal} –∑–∞–≤—Ä—à–µ–Ω–æ`;
              })
            );
          });

          acc.appendChild(content);
          container.appendChild(acc);

          // Accordion toggle
          header.onclick = function (e) {
            if (e.target.tagName === "INPUT") return;
            acc.classList.toggle("active");
            content.style.display = content.style.display === "none" ? "block" : "none";
          };
        });
      }

      // Toggle all sections
      function toggleAllSections(expand) {
        document.querySelectorAll(".accordion-content").forEach(content => {
          content.style.display = expand ? "block" : "none";
        });
        document.querySelectorAll(".accordion").forEach(acc => {
          acc.classList.toggle("active", expand);
        });
      }

      // --- Search/Filter Logic ---
      document.getElementById("search-input").addEventListener("input", function (e) {
        const val = e.target.value.toLowerCase();
        document.querySelectorAll(".section-items label").forEach(label => {
          const text = label.textContent.toLowerCase();
          label.style.display = text.includes(val) ? "flex" : "none";
        });
      });

      // --- Initial Render on Load ---
      window.onload = function () {
        populateDateDropdown();
        renderCleaningAccordions();
        renderConsumablesAccordions();
        renderInventoryFilterDropdown();
        renderInventoryAccordions();
        renderShoppingList();
        // Load saved notes
        const savedNotes = localStorage.getItem("notes");
        if (savedNotes) {
          document.getElementById("notes").value = savedNotes;
        }
      };
      function populateDateDropdown() {
        const select = document.getElementById("date");
        const today = new Date();
        for (let i = 0; i < 7; i++) {
          const d = new Date(today);
          d.setDate(today.getDate() + i);
          const dd = String(d.getDate()).padStart(2, "0");
          const mm = String(d.getMonth() + 1).padStart(2, "0");
          const yyyy = d.getFullYear();
          const dateStr = `${dd}-${mm}-${yyyy}`;
          const option = document.createElement("option");
          option.value = dateStr;
          option.text = dateStr;
          if (i === 0) option.selected = true;
          select.appendChild(option);
        }
      }
      function saveChecklist() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Register and set DejaVu font for Cyrillic support
        try {
          doc.addFileToVFS("DejaVuSans.ttf", dejavu_sans_normal);
          doc.addFont("DejaVuSans.ttf", "DejaVu", "normal");
          doc.setFont("DejaVu");
        } catch (e) {
          console.error("Font loading error:", e);
          doc.setFont("Tahoma");
        }

        doc.setFontSize(16);
        let y = 10;

        // --- Cleaning List ---
        doc.text("Cleaning List", 10, y);
        y += 10;
        doc.setFontSize(12);
        for (const [section, items] of Object.entries(CleaningSections)) {
          doc.text(section, 10, y);
          y += 8;
          const checkedArr = JSON.parse(localStorage.getItem("checked_" + section) || "[]");
          items.forEach((item, idx) => {
            const checked = checkedArr[idx];
            const text = "[" + (checked ? "x" : " ") + "] " + item;
            doc.text(text, 14, y);
            y += 7;
            if (y > 280) {
              doc.addPage();
              y = 10;
            }
          });
          y += 4;
        }

        // Notes
        const notes = document.getElementById("notes").value;
        if (notes) {
          doc.text("Notes:", 10, y);
          y += 7;
          doc.text(notes, 10, y);
        }

        doc.addPage();
        y = 10;

        // --- Consumables List ---
        doc.setFontSize(16);
        doc.text("Consumables List", 10, y);
        y += 10;
        doc.setFontSize(12);
        for (const [section, items] of Object.entries(ConsumablesSections)) {
          doc.text(section, 10, y);
          y += 8;
          const checkedArr = JSON.parse(localStorage.getItem("checked_" + section) || "[]");
          items.forEach((item, idx) => {
            const checked = checkedArr[idx];
            const text = "[" + (checked ? "x" : " ") + "] " + item;
            doc.text(text, 14, y);
            y += 7;
            if (y > 280) {
              doc.addPage();
              y = 10;
            }
          });
          y += 4;
        }

        doc.addPage();
        y = 10;

        // --- Inventory List ---
        doc.setFontSize(16);
        doc.text("Inventory List", 10, y);
        y += 10;
        doc.setFontSize(12);
        for (const [section, items] of Object.entries(InventorySections)) {
          doc.text(section, 10, y);
          y += 8;
          const checkedArr = JSON.parse(localStorage.getItem("checked_" + section) || "[]");
          items.forEach((item, idx) => {
            // item is now an object: {text, type}
            const checked = checkedArr[idx];
            const text = "[" + (checked ? "x" : " ") + "] " + item.text + " (" + item.type + ")";
            doc.text(text, 14, y);
            y += 7;
            if (y > 280) {
              doc.addPage();
              y = 10;
            }
          });
          y += 4;
        }

        // --- Shopping List ---
        doc.setFontSize(16);
        doc.text("Shopping List", 10, y);
        y += 10;
        doc.setFontSize(12);

        const shoppingUl = document.getElementById("shopping-list");
        if (shoppingUl) {
          const lis = shoppingUl.querySelectorAll("li");
          lis.forEach(li => {
            const cb = li.querySelector("input[type='checkbox']");
            const checked = cb && cb.checked;
            const text = "[" + (checked ? "x" : " ") + "] " + li.innerText.trim();
            doc.text(text, 14, y);
            y += 7;
            if (y > 280) {
              doc.addPage();
              y = 10;
            }
          });
        }

        // --- Save PDF ---
        const date = document.getElementById("date").value;
        doc.save("Lynx_Checklist_" + date + ".pdf");
      }

      // --- Consumables List Logic ---
      const ConsumablesGroups = [
        {
          group: "–ü–æ—Ç—Ä–æ—à–µ–Ω –º–∞—Ç–µ—Ä–∏—ò–∞–ª –∑–∞ –≤–æ –ö—É—ò–Ω–∞",
          sections: ["–ö—É—ò–Ω–∞"],
        },
        {
          group: "–ü–æ—Ç—Ä–æ—à–µ–Ω –º–∞—Ç–µ—Ä–∏—ò–∞–ª –∑–∞ –≤–æ –ö—É–ø–∞—Ç–∏–ª–æ",
          sections: ["–ö—É–ø–∞—Ç–∏–ª–æ"],
        },
        {
          group: "–û—Å—Ç–∞–Ω–∞—Ç–æ",
          sections: ["–î–Ω–µ–≤–Ω–∞", "–ú–∏–Ω–∏–±–∞—Ä", "–•–æ–¥–Ω–∏–∫"],
        },
      ];

      const ConsumablesSections = {
        –ö—É—ò–Ω–∞: [
          "–°—ò–∞—ò –∑–∞ —Å—É–¥–æ–≤–∏, —Å—É–Ω–≥–µ—Ä—á–∏—ö–∞",
          "–°—Ä–µ–¥—Å—Ç–≤–∞ –∑–∞ —á–∏—Å—Ç–µ—ö–µ (–ü—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–Ω–æ, –î–µ–ì—Ä–∞—Å, –ü–ª–æ—Ç–Ω–∞)",
          "–¢–∞–±–ª–µ—Ç–∏ –∑–∞ –º–∞—à–∏–Ω–∞ –∑–∞ –º–∏–µ—ö–µ —Å–∞–¥–æ–≤–∏",
          "–ö–µ—Å–∏ –∑–∞ —ì—É–±—Ä–µ",
          "–ë—Ä–∏—Å–∞—á–∏ (—Ä–æ–ª–Ω–∞ —Ö–∞—Ä—Ç–∏—ò–∞)",
          "–ö—Ä–ø–∏ –∑–∞ –ø—Ä–∞—à–∏–Ω–∞ (–í–∏–ª–µ–¥–∞ –∏ –ø–∞–º—É—á–Ω–∏)",
          "–°–æ–ª, —à–µ—ú–µ—Ä, –º–∞—Å–ª–æ, –æ—Ü–∞—Ç, –∑–∞—á–∏–Ω–∏",
          "–ö–∞—Ñ–µ/–ß–∞—ò/–ë–æ–º–±–æ–Ω–∏/–í–æ–¥–∞",

        ],
        –ö—É–ø–∞—Ç–∏–ª–æ: [
          "–¢–æ–∞–ª–µ—Ç —Ö–∞—Ä—Ç–∏—ò–∞",
          "–°–∞–ø—É–Ω –∑–∞ —Ä–∞—Ü–µ (–¢–µ—á–µ–Ω + –µ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∏)",
          "–ß–µ—Ç–∫–∏—Ü–∞ –∏ –ø–∞—Å—Ç–∞ –∑–∞ –∑—É–±–∏ (–µ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∏)",
          "–ü–∞–º—É—á–Ω–∏ —Ç—É—Ñ–µ—Ä–∏",
          "–ü–∞–º—É—á–Ω–∏ —Å—Ç–∞–ø—á–∏—ö–∞",
          "–û—Å–≤–µ–∂—É–≤–∞—á–∏ –∑–∞ –≤–æ–∑–¥—É—Ö",
          "–°—Ä–µ–¥—Å—Ç–≤–æ –∑–∞ –¥–µ–∑–∏–Ω—Ñ–µ–∫—Ü–∏—ò–∞",
          "–°—Ä–µ–¥—Å—Ç–≤–æ –∑–∞ –í–¶ —à–æ—ô–∞ (–æ—Å–≤–µ–∂–∏–≤–∞—á)",
          "–°—Ä–µ–¥—Å—Ç–≤–æ/–¢–∞–±–ª–µ—Ç–∏ –∑–∞ –ø–µ—Ä–µ—ö–µ –∞–ª–∏—à—Ç–∞",
          "–°—Ä–µ–¥—Å—Ç–≤–æ –ø—Ä–æ—Ç–∏–≤ –∫–∞–º–µ–Ω–∞—Ü",
          "–†–∞–∫–∞–≤–∏—Ü–∏ –∑–∞ —á–∏—Å—Ç–µ—ö–µ",
        ],
        –î–Ω–µ–≤–Ω–∞: ["–ë–∞—Ç–µ—Ä–∏–µ –∑–∞ –¥–∞—ô–∏–Ω—Å–∫–æ", "–°–∏—ò–∞–ª–∏—Ü–∏ –∑–∞ –õ—É—Å—Ç–µ—Ä", "–°–∏—ò–∞–ª–∏—Ü–∞ –∑–∞ –°—Ç–æ–ª–Ω–∞ –ª–∞–º–ø–∞"],
        –ú–∏–Ω–∏–±–∞—Ä: [
          "5 –í–∏–Ω–∞ (700ml —Å–µ–∫–æ–µ)",
          "5 –ñ–µ—Å—Ç–æ–∫–∏ –ø–∏—ò–∞–ª–æ—Ü–∏ (50ml —Å–µ–∫–æ–µ)",
          "5 –ì—Ä–∏—Ü–∫–∏ (—á–∏–ø—Å, —ò–∞—Ç–∫–∞—Å—Ç–∏ –ø–ª–æ–¥–æ–≤–∏ –∏—Ç–Ω.)",
          "2 –ß–æ–∫–æ–ª–∞–¥–∞ (50g —Å–µ–∫–æ–µ)",
        ],
        –•–æ–¥–Ω–∏–∫: ["–ë–æ—ò–∞ –∑–∞ —Ü–∏–ø–µ–ª–µ (2)", "–†–æ–ª–µ—Ä –∑–∞ —á–∏—Å—Ç–µ—ö–µ –≤–ª–∞–∫–Ω–∞ (1)"],
      };

      // --- Inventory List Logic ---
      const InventoryGroups = [
        {
          group: "–°–æ–±–∏",
          sections: ["–î–Ω–µ–≤–Ω–∞ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞", "–°–ø–∞–ª–Ω–∞ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞"],
        },
        {
          group: "–ö—É—ò–Ω–∞ –∏ –¢—Ä–ø–µ–∑–∞—Ä–∏—ò–∞",
          sections: ["–ö—É—ò–Ω–∞ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞", "–¢—Ä–ø–µ–∑–∞—Ä–∏—ò–∞ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞"],
        },

        {
          group: "–ö—É–ø–∞—Ç–∏–ª–æ",
          sections: ["–ö—É–ø–∞—Ç–∏–ª–æ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞"],
        },
        {
          group: "–û—Å—Ç–∞–Ω–∞—Ç–æ",
          sections: ["–•–æ–¥–Ω–∏–∫ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞", "–¢–µ—Ä–∞—Å–∞ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞"],
        },
      ];

      // Inventory items now have type: 'E' (Essential) or 'O' (Optional)
      const InventorySections = {
        "–î–Ω–µ–≤–Ω–∞ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞": [
          { text: "–°—Ç–æ–ª–Ω–∞ –ª–∞–º–ø–∞ (1) (IKEA: 30405042)", type: "E" },
          { text: "–ü–µ—Ä–Ω–∏—Ü–∏, –±–µ–ª–∏/—Ç–≤—Ä–¥–∏, 50x50 —Å–º (2)(IKEA: 50550702)", type: "E" },
          { text: "–ü–æ–∫—Ä–∏–≤–∫–∞ –Ω–∞ –≥–∞—Ä–Ω–∏—Ç—É—Ä–∞ (2)", type: "O" },
          { text: "–£–º–µ—Ç–Ω–∏—á–∫–∞ —Å–ª–∏–∫–∞ –Ω–∞ —ï–∏–¥ (1)", type: "O" },
          { text: "–ü–æ–¥–ª–æ–≥–∞ –∑–∞ –º–∞—Å–∞, –≤–æ–¥–µ–Ω –∑—É–º–±—É–ª, 37 —Å–º (1) (IKEA: 40082536)", type: "O" },
          { text: "Computer Mouse (1)", type: "O" },
          { text: "HDMI –∫–∞–±–µ–ª (1)", type: "O" },
          { text: "US to EU –∞–¥–∞–ø—Ç–µ—Ä (2)", type: "O" },
          { text: "–ü—Ä–æ–¥—É–∂–∞–Ω –∫–∞–±–∞–ª (1)", type: "O" },
          { text: "–ö–Ω–∏–≥–∏ –∑–∞ –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞ (3)", type: "O" },
          { text: "–£–∫—Ä–∞—Å–∏ –Ω–∞ —Å—Ç–∞–ª–∞–∂–∞ –¥–µ—Å–Ω–æ", type: "O" },
          { text: "–°–≤–µ—ú–∏ –Ω–∞ –±–∞—Ç–µ—Ä–∏—ò–∞ (2)", type: "O" },
          { text: "–ö–æ—à–Ω–∏—Ü–∞ –∑–∞ —Ü–≤–µ—ú–µ, –º–æ—Ä—Å–∫–∞ —Ç—Ä–µ–≤–∞, 25—Å–º (1) (IKEA: 60322173)", type: "O" },
        ],
        "–ö—É—ò–Ω–∞ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞": [
          { text: "–ù–æ–∂, 3 –∫–æ–º (IKEA: 70257624)", type: "E" },
          { text: "–ù–æ–∂, —Ü—Ä–Ω 22 —Ü–º (4)(IKEA: 00287295)", type: "E" },
          { text: "–î–∞—Å–∫–∞ –∑–∞ —Å–µ—á–µ—ö–µ, –±–∞–º–±—É—Å, 45x28 —Å–º (IKEA: 80233430)", type: "E" },
          { text: "–û—Å—Ç—Ä–∏–ª–∫–∞ –∑–∞ –Ω–æ–∂–µ–≤–∏, —Ü—Ä–Ω–∞ (IKEA: 57145296)", type: "O" },
          { text: "–õ—É–ø–∞–ª–∫–∞ –∑–∞ –∫–æ–º–ø–∏—Ä–∏, –∑–µ–ª–µ–Ω–∞ (IKEA: 90521963)", type: "O" },
          { text: "–ó–¥–µ–ª–∞ –∑–∞ —Å–∞–ª–∞—Ç–∞, –ø—Ä–æ—ï–∏—Ä–Ω–æ —Å—Ç–∞–∫–ª–æ, 20 —Å–º (IKEA: 90057252)", type: "O" },
          {
            text: "–ü—Ä–∏–±–æ—Ä –∑–∞ —ò–∞–¥–µ—ö–µ, 30 –ø–∞—Ä—á–∏—ö–∞, –æ–¥ –Ω–µ'—Ä—ì–æ—Å—É–≤–∞—á–∫–∏ —á–µ–ª–∏–∫ (IKEA: 30167507)",
            type: "E",
          },
          { text: "–¢–µ–Ω—ü–µ—Ä–µ –∑–∞ –≥–æ—Ç–≤–µ—ö–µ —Å–æ –∫–∞–ø–∞–∫ (3), —Ç–∏–≥–∞—ö (1)(IKEA: 80580104)", type: "E" },
          { text: "–ü–æ–¥–º–µ—Ç–∞—á –∑–∞ —Ç–µ–Ω—ü–µ—Ä–µ, –ø–ª—É—Ç–∞, 19 —Å–º (IKEA: 87077700)", type: "O" },
          { text: "–î—Ä–∂–∞—á –∑–∞ –≤—Ä—É—ú–æ —Ç–µ–Ω—ü–µ—Ä–µ, —Å–∏–≤, 21x21 —Å–º (IKEA: 00476366)", type: "O" },
          { text: "–°–∞–¥ –∑–∞ —Å–æ–ª/–±–∏–±–µ—Ä, –ø—Ä–æ—ï–∏—Ä–Ω–æ —Å—Ç–∞–∫–ª–æ 8—Å–º ( IKEA: 40553211)", type: "O" },
          { text: "–ö—É—ò–Ω—Å–∫–∏ –∫—Ä–ø–∏, –±–µ–ª/–∑–µ–ª–µ–Ω/—Å–æ —à–∞—Ä–∏, 45x60 —Å–º (4)(IKEA: 60476354)", type: "E" },
          { text: "–ö—É—ò–Ω—Å–∫–∏ –∫—Ä–ø–∏, –±–µ–ª/—Ç–µ–º–Ω–æ —Å–∏–≤/—Å–æ —à–∞—Ä–∏, 45x60 —Å–º (8)(IKEA: 20476346)", type: "E" },
          { text: "–ü–æ–ª–∏—Ü–∞ —Ü–µ–¥–µ—ö–µ –∑–∞ —Å–∞–¥–æ–≤–∏ (1)(IKEA: 80461276)", type: "O" },
          { text: "–ñ–∏—Ü–∞ –∑–∞ –º–∞—Ç–µ—ö–µ, —Ç—Ä–∫–∞–ª–µ–∑–Ω–∞ (1)(IKEA: 10225952)", type: "O" },
          {
            text: "–û—Ä–≥–∞–Ω–∏–∑–µ—Ä –∑–∞ –ø—Ä–∏–±–æ—Ä –∑–∞ —ò–∞–¥–µ—ö–µ, —Å–≤–µ—Ç–ª–∞ –±–∞–º–±—É—Å–æ–≤–∞, 52x50 —Å–º (IKEA: 70433104)",
            type: "O",
          },
          { text: "–†–µ–Ω–¥–µ", type: "O" },
          { text: "–¢–æ—Å—Ç–µ—Ä, —Ü—Ä–Ω", type: "O" },
          { text: "–ë–æ–∫–∞–ª –∑–∞ –≤–æ–¥—É –Ω–∞ —Å—Ç—Ä—É—ò–∞", type: "O" },
          { text: "–ö–∞—Ñ–µ–º–∞—Ç KRUPS KP 243B10, 1000W, 15 bar", type: "O" },
          { text: "–ó–¥–µ–ª–∞ –∑–∞ –∫–∞–ø—Å—É–ª–µ –∑–∞ –∫–∞—Ñ–µ (Temu)", type: "O" },
        ],
        "–¢—Ä–ø–µ–∑–∞—Ä–∏—ò–∞ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞": [
          { text: "–ü–æ–¥–ª–æ–≥–∞ –∑–∞ –º–∞—Å–∞, —Ç–µ–º–Ω–æ —Å–∏–≤–∞, 38x30—Å–º (4) (IKEA: 20569251)", type: "O" },
          { text: "–í–∞–∑–Ω–∞, –ø—Ä–æ—ï–∏—Ä–Ω–æ —Å—Ç–∞–∫–ª–æ –≤–æ –±–æ—ò–∞", type: "O" },
          { text: "–¢—Ä–ø–µ–∑–∞—Ä–∏—Å–∫–∞ –º–∞—Å–∞ —Å–æ 4 —Å—Ç–æ–ª–∏—Ü–∏", type: "E" },
        ],
        "–°–ø–∞–ª–Ω–∞ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞": [
          { text: "–û—Ñ–∏–Ω–≥–µ—Ä (8) (IKEA: 30238543)", type: "E" },
          { text: "–í–æ–¥–æ–æ—Ç–ø–æ—Ä–µ–Ω –∑–∞—à—Ç–∏—Ç–Ω–∏–∫ –∑–∞ –¥—É—à–µ–∫, 160x200 —Å–º (2) (IKEA: 60522129)", type: "E" },
          {
            text: "–ù–∞–≤–ª–∞–∫–∞ –∑–∞ —ò–æ—Ä–≥–∞–Ω –∏ 2 –Ω–∞–≤–ª–∞–∫–∏ –∑–∞ –ø–µ—Ä–Ω–∏—Ü–∏, —Å–∏–≤–∞/–ø—Ä—É–≥–∞—Å—Ç–∞, 200x200/50x60—Å–º (2) (IKEA: 70423242)",
            type: "E",
          },
          {
            text: "–ù–∞–≤–ª–∞–∫–∞ –∑–∞ —ò–æ—Ä–≥–∞–Ω –∏ 2 –Ω–∞–≤–ª–∞–∫–∏ –∑–∞ –ø–µ—Ä–Ω–∏—Ü–∏, –±–µ–ª–∞, 200x200/50x60 —Å–º (1) (IKEA: 20377959)",
            type: "E",
          },
          { text: "–ß–∞—Ä—à–∞—Ñ, –±–µ–ª–∞, 160x200 —Å–º (3) (IKEA: 30357220)", type: "E" },
          { text: "–à–æ—Ä–≥–∞–Ω –∑–∞ —Å–∏—Ç–µ —Å–µ–∑–æ–Ω–∏, 200x200 —Å–º (1+1) (IKEA: 70458585)", type: "E" },
          { text: "–ù–∞–≤–ª–∞–∫–∞ –∑–∞ –ø–µ—Ä–Ω–∏—Ü–∞, —Å–≤–µ—Ç–ª–æ —Å–∏–≤–∞, 50x60 —Å–º (1) (IKEA: 90482476)", type: "O" },
          { text: "–ù–∞–≤–ª–∞–∫–∞ –∑–∞ –ø–µ—Ä–Ω–∏—Ü–∞, –±–µ–ª–∞, 50x60 —Å–º (3) (IKEA: 10357301)", type: "O" },
          { text: "–ü–µ—Ä–Ω–∏—Ü–∞, –≤–∏—Å–æ–∫–∞, 50x60 —Å–º (2) (IKEA: 20460411)", type: "E" },
          { text: "–ü–µ—Ä–Ω–∏—Ü–∞, –Ω–∏—Å–∫–∞, –Ω–∞ —Å—Ç–æ–º–∞–∫, 50x60 —Å–º (2) (IKEA: 50460546)", type: "O" },
          { text: "–°—Ç–æ–ª–Ω–∞ –ª–∞–º–±–∞, –ø–µ–ø–µ–ª/–±–µ–ª–∞ (2) (IKEA: 60573538)", type: "O" },
          { text: "–ú–∞–ª–µ—á–∫–∞ –ª–∞–º–±–∞ –∑–∞ —á–∏—Ç–∞—ö–µ (1)", type: "O" },
          { text: "–î–∞—Å–∫–∞ –∑–∞ –ø–µ–≥–ª–∞—ö–µ", type: "O" },
          { text: "–ü–µ–≥–ª–∞", type: "O" },
          { text: "–ü—Ä–µ–∫—Ä–∏–≤–∞—á/–∫–µ–±–µ, —Ç–µ–º–Ω–æ —Å–∏–≤–∞, 230x250—Å–º (1) (IKEA: 60346447)", type: "O" },
          { text: "–ö–µ–±–µ —Ç–µ–Ω–∫–æ (1)", type: "O" },
          { text: "–ö–µ–±–µ –¥–µ–±–µ–ª–æ (1)", type: "O" },
          { text: "–ö—Ä–µ–≤–µ—Ç –∑–∞ –¥–µ—Ü–∞ (–É–æ—Ä–µ)", type: "O" },
          { text: "–ù–∞–≤–ª–∞–∫–∞ –∑–∞ —Å–∞–∫–æ (1)", type: "O" },
        ],
        "–ö—É–ø–∞—Ç–∏–ª–æ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞": [
          { text: "–°–∞–∫—Å–∏—ò–∞ –∑–∞ —Ü–≤–µ—ú–µ (IKEA: 40395617)", type: "O" },
          { text: "–ö–∞–Ω—Ç–∞ –∑–∞ –æ—Ç–ø–∞–¥ (IKEA: 20593736)", type: "E" },
          { text: "–ß–µ—Ç–∫–∞ –∑–∞ —Ç–æ–∞–ª–µ—Ç (IKEA: 10593727)", type: "E" },
          { text: "–î—Ä–∂–∞—á –∑–∞ —Ç–æ–∞–ª–µ—Ç–Ω–∞ —Ö–∞—Ä—Ç–∏—ò–∞ (IKEA: 40381291)", type: "E" },
          { text: "–ö—Ä–ø–∞ –∑–∞ –±–∞—ö–∞—ö–µ, (6), 70x140 —Å–º (IKEA: 80350985)", type: "E" },
          { text: "–ö—Ä–ø–∞ –∑–∞ —Ä—É–∫–µ, (6), 50x100 —Å–º (IKEA: 70350995)", type: "E" },
          { text: "–¢—É—à —Ä—É—á–∫–∞ (IKEA: 60342543)", type: "O" },
          { text: "–¢–µ–ø–∏—Ö –∑–∞ –±–∞—ö—É, —Ç–∏—Ä–∫–∏–∑–Ω–∞, 50x80 —Å–º (IKEA: 40603169)", type: "O" },
          { text: "–î–æ–∑–∞—Ç–æ—Ä –∑–∞ —Å–∞–ø—É–Ω (IKEA: 30593726)", type: "O" },
          { text: "–î—Ä–∂–∞—á –∑–∞ —á–µ—Ç–∫–∏—Ü–µ –∑–∞ –∑—É–±–∏ (IKEA: 50593730)", type: "O" },
          { text: "–°–∞–º–æ–ª–µ–ø–ª–∏–≤–∞ –∫—É–∫–∞ (2) (IKEA: 50567830)", type: "O" },
          { text: "–ù–∞–¥–≤–æ—Ä–µ—à–Ω–∏ –ø–æ–ª–∏—Ü–∏ –∑–∞ –∫—Ä–ø–µ, –±–∞–º–±—É—Å, 37x37x104—Å–º (1)(IKEA: 80549420)", type: "O" },
          { text: "–ö—É—Ç–∏—ò–∞ –∑–∞ –ø—Ä–≤–∞ –ø–æ–º–æ—à Praxis ‚Äì JUS 5015", type: "E" },
          { text: "–ö–æ—Ä–ø–∞ –∑–∞ —Ñ–µ–Ω (STOREAGE)", type: "O" },
          { text: "–§–µ–Ω –∑–∞ –∫–æ—Å—É (MAX HD22IR)", type: "O" },
          { text: "–¢–æ—Ä–±–∞ –∑–∞ —Ñ–µ–Ω (Temu)", type: "O" },
          { text: "–ü–ª–∞—Å—Ç–∏—á–Ω–∞ –∫–æ—Ä–ø–∞ –∑–∞ –≤–µ—à (Temu)", type: "O" },
          { text: "–ì—É–º–µ–Ω–∏ –ø–∞–ø—É—á–µ (Temu)", type: "O" },
          { text: "–ü—Ä–≤–∞ –ø–æ–º–æ—à –∫—É—Ç–∏—ò–∞", type: "E" },
        ],
        "–•–æ–¥–Ω–∏–∫ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞": [
          { text: "–ü–æ–¥–ª–æ–≥–∞ –∑–∞ —Ü–∏–ø–µ–ª–µ 71x35 —Å–º(IKEA: 60329711)", type: "O" },
          { text: "–£—Å–∏—Å—É–≤–∞—á (MAKS VC 2200SW)", type: "E" },
          { text: "–ö–∞—à–∏–∫–∞ –∑–∞ —Ü–∏–ø–µ–ª–µ", type: "O" },
        ],
        "–¢–µ—Ä–∞—Å–∞ –ò–Ω–≤–µ–Ω—Ç—É—Ä–∞": [
          { text: "–°—Ç–æ–ª–∏—Ü–∞ –∑–∞ —Å–µ–¥–µ—ö–µ (2)(IKEA: 90095428)", type: "O" },
          { text: "–ê—Å—Ç–∞–ª—á–µ –∑–∞ —Ç–µ—Ä–∞—Å—É (1)(IKEA: 70095429)", type: "O" },
        ],
      };

      // --- Inventory Filter Dropdown ---
      let inventoryFilter = "all"; // 'all', 'E', 'O'

      function renderInventoryFilterDropdown() {
        const container = document.getElementById("inventory-sections");
        let filterDiv = document.getElementById("inventory-filter-div");
        if (!filterDiv) {
          filterDiv = document.createElement("div");
          filterDiv.id = "inventory-filter-div";
          filterDiv.style.marginBottom = "10px";
          filterDiv.innerHTML = `
            <select id="inventory-filter" class="view-all-btn" style="width:auto;">
              <option value="all">–°–∏—Ç–µ</option>
              <option value="E">–°–∞–º–æ Essentials</option>
              <option value="O">–°–∞–º–æ Optional</option>
            </select>
          `;
          container.parentNode.insertBefore(filterDiv, container);
          document.getElementById("inventory-filter").addEventListener("change", function (e) {
            inventoryFilter = e.target.value;
            renderInventoryAccordions();
          });
        }
      }

      // --- Inventory Accordion Rendering ---
      function renderInventoryAccordions() {
        const container = document.getElementById("inventory-sections");
        // Remove all except filter dropdown
        container
          .querySelectorAll(".accordion, .section-controls, .section")
          .forEach(e => e.remove());

        InventoryGroups.forEach(groupObj => {
          const acc = document.createElement("div");
          acc.className = "accordion";

          const header = document.createElement("div");
          header.className = "accordion-header";

          // Calculate total and completed items for this group (respecting filter)
          let totalItems = 0;
          let completedItems = 0;
          groupObj.sections.forEach(section => {
            const items = InventorySections[section];
            let filteredItems = items;
            if (inventoryFilter === "E") filteredItems = items.filter(i => i.type === "E");
            if (inventoryFilter === "O") filteredItems = items.filter(i => i.type === "O");
            totalItems += filteredItems.length;
            const checkedArr = JSON.parse(localStorage.getItem("checked_" + section) || "[]");
            if (Array.isArray(checkedArr)) {
              filteredItems.forEach((item, idx) => {
                // Find the index of this item in the original items array
                const origIdx = items.indexOf(item);
                if (checkedArr[origIdx]) completedItems++;
              });
            }
          });

          header.innerHTML = `
            <span>${groupObj.group}</span>
            <span class="section-stats">${completedItems}/${totalItems} –∑–∞–≤—Ä—à–µ–Ω–æ</span>
          `;
          acc.appendChild(header);

          const content = document.createElement("div");
          content.className = "accordion-content";

          groupObj.sections.forEach(section => {
            content.appendChild(
              renderSectionWithProgress(
                section,
                InventorySections[section],
                section,
                () => {
                  // Update group progress when any item changes
                  let newTotal = 0;
                  let newCompleted = 0;
                  groupObj.sections.forEach(s => {
                    const items = InventorySections[s];
                    let filteredItems = items;
                    if (inventoryFilter === "E") filteredItems = items.filter(i => i.type === "E");
                    if (inventoryFilter === "O") filteredItems = items.filter(i => i.type === "O");
                    newTotal += filteredItems.length;
                    const checkedArr = JSON.parse(localStorage.getItem("checked_" + s) || "[]");
                    if (Array.isArray(checkedArr)) {
                      filteredItems.forEach((item, idx) => {
                        const origIdx = items.indexOf(item);
                        if (checkedArr[origIdx]) newCompleted++;
                      });
                    }
                  });
                  header.querySelector(
                    ".section-stats"
                  ).textContent = `${newCompleted}/${newTotal} –∑–∞–≤—Ä—à–µ–Ω–æ`;
                },
                true // isInventory
              )
            );
          });

          acc.appendChild(content);
          container.appendChild(acc);

          // Accordion toggle
          header.onclick = function (e) {
            if (e.target.tagName === "INPUT") return;
            acc.classList.toggle("active");
            content.style.display = content.style.display === "none" ? "block" : "none";
          };
        });
      }

      // --- Inventory Section Rendering (with checkboxes and live update) ---
      function renderSectionWithProgress(title, items, sectionKey, onProgressChange, isInventory) {
        const sectionDiv = document.createElement("div");
        sectionDiv.className = "section";

        // Section header
        const header = document.createElement("div");
        header.className = "section-header";
        header.innerHTML = `<label>${title}</label>`;
        sectionDiv.appendChild(header);

        // Items list
        const ul = document.createElement("div");
        ul.className = "checkbox-group section-items";

        // Load checked state from localStorage
        let checkedArr = JSON.parse(localStorage.getItem("checked_" + sectionKey) || "[]");
        if (!Array.isArray(checkedArr) || checkedArr.length !== items.length) {
          checkedArr = Array(items.length).fill(false);
        }

        items.forEach((item, idx) => {
          const label = document.createElement("label");
          label.style.display = "flex";
          label.style.alignItems = "center";
          label.style.justifyContent = "space-between";
          let itemText = isInventory
            ? `${item.text} <span class='inv-type'>(${
                item.type === "E" ? "Essential" : "Optional"
              })</span>`
            : item;
          label.innerHTML = `<span><input type="checkbox" data-section="${sectionKey}" data-idx="${idx}"> ${itemText}</span>`;
          const checkbox = label.querySelector("input[type='checkbox']");
          checkbox.checked = checkedArr[idx];
          checkbox.onchange = function () {
            checkedArr[idx] = checkbox.checked;
            localStorage.setItem("checked_" + sectionKey, JSON.stringify(checkedArr));
            if (onProgressChange) {
              onProgressChange();
            }
          };
          ul.appendChild(label);
        });

        sectionDiv.appendChild(ul);

        // Make header clickable for collapse/expand
        header.onclick = function (e) {
          if (e.target.tagName === "INPUT") return;
          ul.style.display = ul.style.display === "none" ? "block" : "none";
        };

        return sectionDiv;
      }

      // --- Shopping List Logic ---
      let shoppingList = [];
      let dragSrcIndex = null;
      function renderShoppingList() {
        const ul = document.getElementById("shopping-list");
        ul.innerHTML = "";

        // Load shopping list from localStorage
        shoppingList = JSON.parse(localStorage.getItem("shoppingList") || "[]");

        shoppingList.forEach((item, idx) => {
          const li = document.createElement("li");
          li.setAttribute("draggable", "true");
          li.setAttribute("data-index", idx);
          li.style.display = "flex";
          li.style.alignItems = "center";
          li.style.justifyContent = "space-between";
          li.style.padding = "4px 0";
          li.ondragstart = e => {
            dragSrcIndex = idx;
            e.dataTransfer.effectAllowed = "move";
            li.style.opacity = "0.5";
          };
          li.ondragend = () => {
            li.style.opacity = "";
          };
          li.ondragover = e => {
            e.preventDefault();
            li.style.background = "#e6f7ff";
          };
          li.ondragleave = () => {
            li.style.background = "";
          };
          li.ondrop = e => {
            e.preventDefault();
            li.style.background = "";
            if (dragSrcIndex !== null && dragSrcIndex !== idx) {
              const moved = shoppingList.splice(dragSrcIndex, 1)[0];
              shoppingList.splice(idx, 0, moved);
              renderShoppingList();
            }
            dragSrcIndex = null;
          };
          li.innerHTML = `<span><input type="checkbox"> ${item}</span>`;
          ul.appendChild(li);
        });
      }
      function addShoppingItem() {
        const item = prompt("Enter shopping item:");
        if (item && item.trim() !== "") {
          shoppingList.push(item.trim());
          localStorage.setItem("shoppingList", JSON.stringify(shoppingList)); // Save to localStorage
          renderShoppingList();
        }
      }

      // Add event listener for notes
      document.getElementById("notes").addEventListener("input", function (e) {
        localStorage.setItem("notes", e.target.value);
      });

      // Load notes on page load
      window.onload = function () {
        populateDateDropdown();
        renderCleaningAccordions();
        renderConsumablesAccordions();
        renderInventoryFilterDropdown();
        renderInventoryAccordions();
        renderShoppingList();

        // Load saved notes
        const savedNotes = localStorage.getItem("notes");
        if (savedNotes) {
          document.getElementById("notes").value = savedNotes;
        }
      };

      // Modify the renderConsumablesAccordions function
      function renderConsumablesAccordions() {
        const container = document.getElementById("consumables-sections");
        container.innerHTML = "";

        // Add collapse/expand all button
        const controlsDiv = document.createElement("div");
        controlsDiv.className = "section-controls";
        controlsDiv.innerHTML = `
      <button class="view-all-btn" onclick="toggleAllSections(true)">Expand All</button>
      <button class="view-all-btn" onclick="toggleAllSections(false)">Collapse All</button>
    `;
        container.appendChild(controlsDiv);

        ConsumablesGroups.forEach(groupObj => {
          const acc = document.createElement("div");
          acc.className = "accordion";

          const header = document.createElement("div");
          header.className = "accordion-header";

          // Calculate total items and completed items for this group
          let totalItems = 0;
          let completedItems = 0;
          groupObj.sections.forEach(section => {
            const items = ConsumablesSections[section];
            totalItems += items.length;
            let checkedArr = JSON.parse(localStorage.getItem("checked_" + section) || "[]");
            if (!Array.isArray(checkedArr) || checkedArr.length !== items.length) {
              checkedArr = Array(items.length).fill(false);
            }
            completedItems += checkedArr.filter(Boolean).length;
          });

          header.innerHTML = `
            <span>${groupObj.group}</span>
            <span class="section-stats">${completedItems}/${totalItems} –∑–∞–≤—Ä—à–µ–Ω–æ</span>
        `;
          acc.appendChild(header);

          const content = document.createElement("div");
          content.className = "accordion-content";

          groupObj.sections.forEach(section => {
            content.appendChild(
              renderSectionWithProgress(section, ConsumablesSections[section], section, () => {
                // Update group progress when any item changes
                let newTotal = 0;
                let newCompleted = 0;
                groupObj.sections.forEach(s => {
                  const items = ConsumablesSections[s];
                  newTotal += items.length;
                  let checkedArr = JSON.parse(localStorage.getItem("checked_" + s) || "[]");
                  if (!Array.isArray(checkedArr) || checkedArr.length !== items.length) {
                    checkedArr = Array(items.length).fill(false);
                  }
                  newCompleted += checkedArr.filter(Boolean).length;
                });
                header.querySelector(
                  ".section-stats"
                ).textContent = `${newCompleted}/${newTotal} –∑–∞–≤—Ä—à–µ–Ω–æ`;
              })
            );
          });

          acc.appendChild(content);
          container.appendChild(acc);

          // Accordion toggle
          header.onclick = function (e) {
            if (e.target.tagName === "INPUT") return;
            acc.classList.toggle("active");
            content.style.display = content.style.display === "none" ? "block" : "none";
          };
        });
      }

      // Modify renderSectionWithProgress to add shopping cart icon
      function renderSectionWithProgress(title, items, sectionKey, onProgressChange) {
        const sectionDiv = document.createElement("div");
        sectionDiv.className = "section";

        // Section header
        const header = document.createElement("div");
        header.className = "section-header";
        header.innerHTML = `<label>${title}</label>`;
        sectionDiv.appendChild(header);

        // Items list
        const ul = document.createElement("div");
        ul.className = "checkbox-group section-items";

        // Load checked state from localStorage
        let checkedArr = JSON.parse(localStorage.getItem("checked_" + sectionKey) || "[]");
        if (!Array.isArray(checkedArr) || checkedArr.length !== items.length) {
          checkedArr = Array(items.length).fill(false);
        }

        items.forEach((item, idx) => {
          const label = document.createElement("label");
          label.style.display = "flex";
          label.style.alignItems = "center";
          label.style.justifyContent = "space-between";
          // Fix: Always display correct item text
          let displayText = "";
          if (typeof item === "string") {
            displayText = item;
          } else if (item && typeof item === "object") {
            displayText = item.text || item.name || JSON.stringify(item);
          }
          label.innerHTML = `<span><input type="checkbox" data-section="${sectionKey}" data-idx="${idx}"> ${displayText}</span>
                          <button class="add-to-shopping-btn" data-item="${item}" onclick="addToShoppingList('${item}')">
                              üõí
                          </button>`;
          const checkbox = label.querySelector("input[type='checkbox']");
          checkbox.checked = checkedArr[idx];
          checkbox.onchange = function () {
            checkedArr[idx] = checkbox.checked;
            localStorage.setItem("checked_" + sectionKey, JSON.stringify(checkedArr));
            if (onProgressChange) {
              onProgressChange();
            }
          };
          ul.appendChild(label);
        });

        sectionDiv.appendChild(ul);

        // Make header clickable for collapse/expand
        header.onclick = function (e) {
          if (e.target.tagName === "INPUT") return;
          ul.style.display = ul.style.display === "none" ? "block" : "none";
        };

        return sectionDiv;
      }

      function addToShoppingList(item) {
        // Add item to the shopping list array
        shoppingList.push(item);

        // Save the updated shopping list in localStorage
        localStorage.setItem("shoppingList", JSON.stringify(shoppingList));

        // Re-render the shopping list to show the new item
        renderShoppingList();

        // Show a success toast message
        showToast("–£—Å–ø–µ—à–Ω–æ –¥–æ–¥–∞–¥–µ–Ω–æ –≤–æ –®–æ–ø–∏–Ω–≥ –ª–∏—Å—Ç–∞");
      }

      // Logo click: clear all localStorage except theme, reload, show popup after reload
      document.getElementById("lynx-logo").addEventListener("click", function () {
        if (confirm("Do you want to reset all progress and clear the checklist?")) {
          const theme = localStorage.getItem("lynx-theme");
          localStorage.clear();
          if (theme) localStorage.setItem("lynx-theme", theme);
          sessionStorage.setItem("checklist-reset", "1");
          location.reload();
        }
      });

      // On load, show reset popup if needed
      window.addEventListener("DOMContentLoaded", function () {
        if (sessionStorage.getItem("checklist-reset")) {
          sessionStorage.removeItem("checklist-reset");
          // You can use a custom popup, but for simplicity:
          const popup = document.createElement("div");
          popup.textContent = "Checklist has been reset. You now have a blank list.";
          popup.style.position = "fixed";
          popup.style.top = "30px";
          popup.style.left = "50%";
          popup.style.transform = "translateX(-50%)";
          popup.style.background = "#23272a";
          popup.style.color = "#ffe066";
          popup.style.padding = "16px 32px";
          popup.style.borderRadius = "8px";
          popup.style.boxShadow = "0 2px 8px rgba(0,0,0,0.2)";
          popup.style.zIndex = "9999";
          document.body.appendChild(popup);
          setTimeout(() => popup.remove(), 3000);
        }
      });

      function showToast(message) {
        // Create a new toast element
        const toast = document.createElement("div");
        toast.className = "toast";
        toast.textContent = message;

        // Append the toast to the body
        document.body.appendChild(toast);

        // Show the toast
        setTimeout(() => {
          toast.classList.add("show");
        }, 100); // –î–µ–ª—É–º–Ω–æ –∑–∞–±–∞–≤—É–≤–∞—ö–µ –∑–∞ –¥–∞ —Å–µ –∏–∑–±–µ–≥–Ω–µ –º–æ–º–µ–Ω—Ç–∞–ª–Ω–æ –ø—Ä–∏–∫–∞–∂—É–≤–∞—ö–µ

        // Hide the toast after 3 seconds
        setTimeout(() => {
          toast.classList.remove("show");
          // Remove the toast from the DOM after animation
          setTimeout(() => {
            toast.remove();
          }, 500); // –ü–æ—á–µ–∫–∞—ò—Ç–µ 500ms –ø—Ä–µ–¥ –¥–∞ –≥–æ –æ—Ç—Å—Ç—Ä–∞–Ω–∏—Ç–µ toast
        }, 1000); // –ü–æ—Ä–∞–∫–∞—Ç–∞ —ú–µ –∏—Å—á–µ–∑–Ω–µ –ø–æ 3 —Å–µ–∫—É–Ω–¥–∏
      }

      function renderInventorySectionItems(sectionId, title) {
        const groupEss = document.getElementById(sectionId + "_inventory_essential");
        const groupOpt = document.getElementById(sectionId + "_inventory_optional");
        groupEss.innerHTML = "";
        groupOpt.innerHTML = "";
        (inventorySections[title].essential || []).forEach((item, idx) => {
          const label = document.createElement("label");
          label.style.display = "flex";
          label.style.alignItems = "center";
          label.style.justifyContent = "space-between";
          let displayText =
            typeof item === "object" ? item.text || item.name || JSON.stringify(item) : item;
          label.innerHTML = `<span><input type="checkbox"> ${displayText}</span>`;
          groupEss.appendChild(label);
        });
        (inventorySections[title].optional || []).forEach((item, idx) => {
          const label = document.createElement("label");
          label.style.display = "flex";
          label.style.alignItems = "center";
          label.style.justifyContent = "space-between";
          let displayText =
            typeof item === "object" ? item.text || item.name || JSON.stringify(item) : item;
          label.innerHTML = `<span><input type="checkbox"> ${displayText}</span>`;
          groupOpt.appendChild(label);
        });
      }
    </script>
  </body>
</html>
