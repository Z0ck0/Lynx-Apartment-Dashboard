<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lynx Apartments - Admin Panel</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,600,700&display=swap" rel="stylesheet">
    <style>
        :root {
            --lynx-blue: #0078d7;
            --lynx-yellow: #ffe066;
            --lynx-bg: #f9f9f9;
            --lynx-dark: #23272a;
            --lynx-card: #ffffff;
            --lynx-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            --lynx-shadow-hover: 0 8px 32px rgba(0, 120, 215, 0.15);
            --lynx-border-radius: 16px;
            --lynx-transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 12px;
            --transition: all 0.2s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "Poppins", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--lynx-bg);
            color: var(--lynx-dark);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--lynx-transition);
        }

        /* Theme Toggle Button */
        #theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            border: 2px solid rgba(0, 0, 0, 0.1);
            background: var(--lynx-card);
            color: var(--lynx-dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: var(--lynx-transition);
            box-shadow: var(--lynx-shadow);
            z-index: 1001;
        }

        #theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: var(--lynx-shadow-hover);
            border-color: var(--lynx-blue);
        }

        #theme-toggle:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 120, 215, 0.2);
        }

        #theme-toggle:active {
            transform: translateY(0);
        }

        .container {
            max-width: 800px;
            width: 100%;
            padding: 24px;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .admin-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--lynx-blue);
            font-family: "Poppins", Arial, sans-serif;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: -0.02em;
        }

        .admin-subtitle {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 24px;
        }

        .card {
            background: var(--lynx-card);
            border-radius: var(--lynx-border-radius);
            box-shadow: var(--lynx-shadow);
            padding: 32px;
            margin-bottom: 24px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: var(--lynx-transition);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--lynx-dark);
            font-family: "Poppins", Arial, sans-serif;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--lynx-transition);
            font-family: "Roboto", Arial, sans-serif;
            background: var(--lynx-card);
            color: var(--lynx-dark);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--lynx-blue);
            box-shadow: 0 0 0 3px rgba(0, 120, 215, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        .form-row {
            display: flex;
            gap: 16px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--lynx-transition);
            font-family: "Poppins", Arial, sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--lynx-blue);
            color: white;
        }

        .btn-primary:hover {
            background: #005a9e;
            transform: translateY(-2px);
            box-shadow: var(--lynx-shadow-hover);
        }

        .btn-success {
            background: var(--lynx-yellow);
            color: var(--lynx-dark);
        }

        .btn-success:hover {
            background: #f5d752;
            transform: translateY(-2px);
            box-shadow: var(--lynx-shadow-hover);
        }

        .btn-block {
            width: 100%;
        }

        .status-chip-group {
            display: flex;
            gap: 12px;
            margin-top: 8px;
        }

        .status-chip {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--lynx-transition);
            border: 2px solid transparent;
        }

        .status-chip.allowed {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .status-chip.not-allowed {
            background: #ffebee;
            color: #c62828;
        }

        .status-chip.selected {
            border-color: var(--lynx-blue);
            box-shadow: 0 0 0 2px rgba(0, 120, 215, 0.2);
        }

        .hidden {
            display: none;
        }

        .file-upload-area {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: var(--lynx-transition);
            margin-top: 8px;
            background: var(--lynx-card);
        }

        .file-upload-area:hover {
            border-color: var(--lynx-blue);
            background: rgba(0, 120, 215, 0.02);
        }

        .file-upload-area.dragover {
            border-color: var(--lynx-blue);
            background: rgba(0, 120, 215, 0.05);
        }

        .file-list {
            margin-top: 16px;
        }

        .file-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .file-item button {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 4px 8px;
            border-radius: 4px;
            transition: var(--lynx-transition);
        }

        .file-item button:hover {
            background: #ffebee;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 16px;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 16px;
            border: 1px solid #f5c6cb;
        }

        .logout-btn {
            position: absolute;
            top: 80px;
            right: 20px;
            background: none;
            border: 2px solid var(--lynx-blue);
            color: var(--lynx-blue);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--lynx-transition);
        }

        .logout-btn:hover {
            background: var(--lynx-blue);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--lynx-shadow-hover);
        }

        .instructions-form .form-row {
            display: block;
        }

        .instructions-form .form-row .form-group {
            margin-bottom: 20px;
        }

        .entry-item {
            background: var(--lynx-card);
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--lynx-transition);
        }

        .entry-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--lynx-shadow-hover);
        }

        .entry-content {
            flex: 1;
        }

        .entry-title {
            font-weight: 600;
            color: var(--lynx-dark);
            margin-bottom: 4px;
        }

        .entry-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .entry-meta {
            font-size: 0.8rem;
            color: #999;
        }

        .entry-actions {
            display: flex;
            gap: 8px;
        }

        .btn-edit {
            background: var(--lynx-blue);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--lynx-transition);
        }

        .btn-edit:hover {
            background: #005a9e;
            transform: translateY(-2px);
        }

        .btn-delete {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--lynx-transition);
        }

        .btn-delete:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--lynx-transition);
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--lynx-card);
            border-radius: var(--lynx-border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .modal-header h2 {
            margin: 0;
            color: var(--lynx-blue);
            font-family: 'Poppins', Arial, sans-serif;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--lynx-transition);
        }

        .close-btn:hover {
            background: #f8f9fa;
            color: var(--lynx-dark);
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding: 20px 24px;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }

        .no-entries {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px;
        }

        /* Dark Mode Styles */
        body.dark-mode {
            --lynx-bg: #1a1a1a;
            --lynx-dark: #ffffff;
            --lynx-card: #2d2d2d;
            --lynx-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            --lynx-shadow-hover: 0 8px 32px rgba(255, 224, 102, 0.15);
        }

        body.dark-mode .admin-subtitle {
            color: #cccccc;
        }

        body.dark-mode #theme-toggle {
            background: var(--lynx-card);
            color: var(--lynx-yellow);
            border-color: rgba(255, 255, 255, 0.2);
        }

        body.dark-mode .card {
            background: var(--lynx-card);
            border-color: rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .form-input,
        body.dark-mode .form-select,
        body.dark-mode .form-textarea {
            background: var(--lynx-card);
            color: var(--lynx-dark);
            border-color: rgba(255, 255, 255, 0.2);
        }

        body.dark-mode .form-input:focus,
        body.dark-mode .form-select:focus,
        body.dark-mode .form-textarea:focus {
            border-color: var(--lynx-blue);
            box-shadow: 0 0 0 3px rgba(0, 120, 215, 0.2);
        }

        body.dark-mode .file-upload-area {
            background: var(--lynx-card);
            border-color: rgba(255, 255, 255, 0.2);
            color: var(--lynx-dark);
        }

        body.dark-mode .file-upload-area:hover {
            border-color: var(--lynx-blue);
            background: rgba(0, 120, 215, 0.1);
        }

        body.dark-mode .file-item {
            background: rgba(255, 255, 255, 0.1);
            color: var(--lynx-dark);
        }

        body.dark-mode .file-item button:hover {
            background: rgba(220, 53, 69, 0.2);
        }

        body.dark-mode .entry-item {
            background: var(--lynx-card);
            border-color: rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .entry-description {
            color: #cccccc;
        }

        body.dark-mode .entry-meta {
            color: #999999;
        }

        body.dark-mode .modal-header,
        body.dark-mode .modal-footer {
            border-color: rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--lynx-dark);
        }

        body.dark-mode .no-entries {
            color: #cccccc;
        }

        body.dark-mode .success-message {
            background: rgba(40, 167, 69, 0.2);
            color: #d4edda;
            border-color: rgba(40, 167, 69, 0.3);
        }

        body.dark-mode .error-message {
            background: rgba(220, 53, 69, 0.2);
            color: #f8d7da;
            border-color: rgba(220, 53, 69, 0.3);
        }

        body.dark-mode .status-chip.allowed {
            background: rgba(46, 125, 50, 0.3);
            color: #4caf50;
        }

        body.dark-mode .status-chip.not-allowed {
            background: rgba(198, 40, 40, 0.3);
            color: #f44336;
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .admin-title {
                font-size: 2rem;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .logout-btn {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 16px;
            }
            
            #theme-toggle {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
        }

        /* Focus Visible for better accessibility */
        .btn:focus-visible,
        .status-chip:focus-visible,
        .entry-item:focus-visible {
            outline: 3px solid var(--lynx-blue);
            outline-offset: 2px;
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <!-- Theme Toggle Button -->
    <button id="theme-toggle" aria-label="Toggle dark mode">
        ðŸŒ™
    </button>

    <div class="container">
        <!-- Login Form -->
        <div id="loginSection" class="card">
            <div class="admin-header">
                <h1 class="admin-title">Admin Panel</h1>
                <p class="admin-subtitle">Please log in to access the content management system</p>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" id="username" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" class="form-input" required>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block">Login</button>
            </form>
            
            <div id="loginError" class="error-message hidden">
                Invalid username or password. Please try again.
            </div>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="hidden">
            <button class="logout-btn" onclick="logout()">Logout</button>
            
            <div class="admin-header">
                <h1 class="admin-title">Content Management</h1>
                <p class="admin-subtitle">Add new entries to House Rules or Instructions</p>
            </div>

            <div class="card">
                <div class="form-group">
                    <label for="pageSelect" class="form-label">Select Page</label>
                    <select id="pageSelect" class="form-select" onchange="showForm()">
                        <option value="">Choose a page...</option>
                        <option value="house-rules">House Rules</option>
                        <option value="instructions">Instructions</option>
                    </select>
                </div>
            </div>

            <!-- House Rules Form -->
            <div id="houseRulesForm" class="card hidden">
                <h2 style="margin-bottom: 24px; color: var(--lynx-blue); font-family: 'Poppins', Arial, sans-serif;">Add New House Rule</h2>
                
                <form id="houseRuleForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ruleIcon" class="form-label">Icon (Emoji)</label>
                            <input type="text" id="ruleIcon" class="form-input" placeholder="ðŸ " maxlength="2">
                        </div>
                        <div class="form-group">
                            <label for="ruleTitle" class="form-label">Rule Title</label>
                            <input type="text" id="ruleTitle" class="form-input" placeholder="Rule Title" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="ruleDescription" class="form-label">Description</label>
                        <textarea id="ruleDescription" class="form-textarea" placeholder="Rule description..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <div class="status-chip-group">
                            <span class="status-chip allowed" onclick="selectStatus(this, 'allowed')">Allowed</span>
                            <span class="status-chip not-allowed" onclick="selectStatus(this, 'not-allowed')">Not Allowed</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="statusText" class="form-label">Status Text (optional)</label>
                        <input type="text" id="statusText" class="form-input" placeholder="e.g., 'Yes', 'No', '3', etc.">
                    </div>
                    
                    <div class="form-group">
                        <label for="ruleType" class="form-label">Rule Type</label>
                        <select id="ruleType" class="form-select" onchange="showRuleTypeFields()">
                            <option value="simple">Simple Rule</option>
                            <option value="time">Time-based Rule</option>
                            <option value="guest">Guest-based Rule</option>
                        </select>
                    </div>
                    
                    <div id="timeFields" class="hidden">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="startTime" class="form-label">Start Time</label>
                                <input type="time" id="startTime" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="endTime" class="form-label">End Time</label>
                                <input type="time" id="endTime" class="form-input">
                            </div>
                        </div>
                    </div>
                    
                    <div id="guestFields" class="hidden">
                        <div class="form-group">
                            <label for="maxGuests" class="form-label">Maximum Guests</label>
                            <input type="number" id="maxGuests" class="form-input" min="1" max="20">
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-success btn-block">Add House Rule</button>
                </form>
            </div>

            <!-- Instructions Form -->
            <div id="instructionsForm" class="card hidden instructions-form">
                <h2 style="margin-bottom: 24px; color: var(--lynx-blue); font-family: 'Poppins', Arial, sans-serif;">Add New Instruction</h2>
                
                <form id="instructionForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="instructionIcon" class="form-label">Icon (Emoji)</label>
                            <input type="text" id="instructionIcon" class="form-input" placeholder="ðŸ› ï¸" maxlength="2">
                        </div>
                        <div class="form-group">
                            <label for="instructionTitle" class="form-label">Instruction Title</label>
                            <input type="text" id="instructionTitle" class="form-input" placeholder="How to..." required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="instructionImages" class="form-label">Images</label>
                        <input type="file" id="instructionImages" class="form-input" multiple accept="image/*">
                        <div class="file-upload-area" onclick="document.getElementById('instructionImages').click()">
                            <p>Click to select images or drag and drop</p>
                            <small>Supports: JPG, PNG, GIF</small>
                        </div>
                        <div id="imagesList" class="file-list"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="instructionVideo" class="form-label">Video (optional)</label>
                        <input type="file" id="instructionVideo" class="form-input" accept="video/*">
                        <div class="file-upload-area" onclick="document.getElementById('instructionVideo').click()">
                            <p>Click to select video or drag and drop</p>
                            <small>Supports: MP4, WebM, MOV</small>
                        </div>
                        <div id="videoList" class="file-list"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="instructionSteps" class="form-label">Detailed Instructions</label>
                        <textarea id="instructionSteps" class="form-textarea" placeholder="Step-by-step instructions..." rows="8"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-success btn-block">Add Instruction</button>
                </form>
            </div>

            <div id="successMessage" class="success-message hidden">
                Entry added successfully!
            </div>

            <!-- Manage Existing Entries Section -->
            <div id="manageEntriesSection" class="card">
                <h2 style="margin-bottom: 24px; color: var(--lynx-blue); font-family: 'Poppins', Arial, sans-serif;">Manage Existing Entries</h2>
                
                <div class="form-group">
                    <label for="managePageSelect" class="form-label">Select Page to Manage</label>
                    <select id="managePageSelect" class="form-select" onchange="loadExistingEntries()">
                        <option value="">Choose a page...</option>
                        <option value="house-rules">House Rules</option>
                        <option value="instructions">Instructions</option>
                    </select>
                </div>

                <div id="existingEntriesList" class="hidden">
                    <h3 style="margin: 20px 0; color: var(--lynx-dark);">Existing Entries</h3>
                    <div id="entriesContainer"></div>
                </div>
            </div>

            <!-- Edit Modal -->
            <div id="editModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="editModalTitle">Edit Entry</h2>
                        <button class="close-btn" onclick="closeEditModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div id="editHouseRuleForm" class="hidden">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="editRuleIcon" class="form-label">Icon (Emoji)</label>
                                    <input type="text" id="editRuleIcon" class="form-input" maxlength="2">
                                </div>
                                <div class="form-group">
                                    <label for="editRuleTitle" class="form-label">Rule Title</label>
                                    <input type="text" id="editRuleTitle" class="form-input" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="editRuleDescription" class="form-label">Description</label>
                                <textarea id="editRuleDescription" class="form-textarea"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <div class="status-chip-group">
                                    <span class="status-chip allowed" onclick="selectEditStatus(this, 'allowed')">Allowed</span>
                                    <span class="status-chip not-allowed" onclick="selectEditStatus(this, 'not-allowed')">Not Allowed</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="editStatusText" class="form-label">Status Text (optional)</label>
                                <input type="text" id="editStatusText" class="form-input">
                            </div>
                            
                            <div class="form-group">
                                <label for="editRuleType" class="form-label">Rule Type</label>
                                <select id="editRuleType" class="form-select" onchange="showEditRuleTypeFields()">
                                    <option value="simple">Simple Rule</option>
                                    <option value="time">Time-based Rule</option>
                                    <option value="guest">Guest-based Rule</option>
                                </select>
                            </div>
                            
                            <div id="editTimeFields" class="hidden">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="editStartTime" class="form-label">Start Time</label>
                                        <input type="time" id="editStartTime" class="form-input">
                                    </div>
                                    <div class="form-group">
                                        <label for="editEndTime" class="form-label">End Time</label>
                                        <input type="time" id="editEndTime" class="form-input">
                                    </div>
                                </div>
                            </div>
                            
                            <div id="editGuestFields" class="hidden">
                                <div class="form-group">
                                    <label for="editMaxGuests" class="form-label">Maximum Guests</label>
                                    <input type="number" id="editMaxGuests" class="form-input" min="1" max="20">
                                </div>
                            </div>
                        </div>

                        <div id="editInstructionForm" class="hidden">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="editInstructionIcon" class="form-label">Icon (Emoji)</label>
                                    <input type="text" id="editInstructionIcon" class="form-input" maxlength="2">
                                </div>
                                <div class="form-group">
                                    <label for="editInstructionTitle" class="form-label">Instruction Title</label>
                                    <input type="text" id="editInstructionTitle" class="form-input" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="editInstructionImages" class="form-label">Images</label>
                                <input type="file" id="editInstructionImages" class="form-input" multiple accept="image/*">
                                <div class="file-upload-area" onclick="document.getElementById('editInstructionImages').click()">
                                    <p>Click to select images or drag and drop</p>
                                    <small>Supports: JPG, PNG, GIF</small>
                                </div>
                                <div id="editImagesList" class="file-list"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="editInstructionVideo" class="form-label">Video (optional)</label>
                                <input type="file" id="editInstructionVideo" class="form-input" accept="video/*">
                                <div class="file-upload-area" onclick="document.getElementById('editInstructionVideo').click()">
                                    <p>Click to select video or drag and drop</p>
                                    <small>Supports: MP4, WebM, MOV</small>
                                </div>
                                <div id="editVideoList" class="file-list"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="editInstructionSteps" class="form-label">Detailed Instructions</label>
                                <textarea id="editInstructionSteps" class="form-textarea" rows="8"></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" onclick="saveEditedEntry()">Save Changes</button>
                        <button class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Dark Mode Logic with Local Storage
        const themeToggle = document.getElementById("theme-toggle");
        const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");

        function setTheme(isDark) {
            document.body.classList.toggle("dark-mode", isDark);
            themeToggle.textContent = isDark ? "â˜€ï¸" : "ðŸŒ™";
            localStorage.setItem("lynx-theme", isDark ? "dark" : "light");

            // Update theme toggle aria-label
            themeToggle.setAttribute(
                "aria-label",
                isDark ? "Switch to light mode" : "Switch to dark mode"
            );
        }

        function toggleTheme() {
            const isCurrentlyDark = document.body.classList.contains("dark-mode");
            setTheme(!isCurrentlyDark);
        }

        // Initialize theme
        function initializeTheme() {
            const savedTheme = localStorage.getItem("lynx-theme");

            if (savedTheme) {
                setTheme(savedTheme === "dark");
            } else {
                // Default to system preference
                setTheme(prefersDarkScheme.matches);
            }
        }

        // Event Listeners
        themeToggle.addEventListener("click", toggleTheme);
        themeToggle.addEventListener("keydown", e => {
            if (e.key === "Enter" || e.key === " ") {
                e.preventDefault();
                toggleTheme();
            }
        });

        // Listen for system theme changes
        prefersDarkScheme.addEventListener("change", e => {
            if (!localStorage.getItem("lynx-theme")) {
                setTheme(e.matches);
            }
        });

        // Initialize theme on load
        document.addEventListener("DOMContentLoaded", initializeTheme);

        // Authentication
        const ADMIN_USERNAME = 'Zoki';
        const ADMIN_PASSWORD = 'Zoki2107!';
        let selectedStatus = '';
        let selectedFiles = [];
        let selectedVideo = null;
        let selectedEditStatus = '';
        let selectedEditFiles = [];
        let selectedEditVideo = null;
        let currentEditIndex = -1;
        let currentEditType = '';

        // Ensure DOM is ready and modal is properly hidden
        document.addEventListener('DOMContentLoaded', function() {
            // Force hide the edit modal on DOM load
            const editModal = document.getElementById('editModal');
            if (editModal) {
                editModal.classList.add('hidden');
            }
        });

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                document.getElementById('loginError').classList.add('hidden');
                
                // Ensure the edit modal is properly hidden after login
                closeEditModal();
            } else {
                document.getElementById('loginError').classList.remove('hidden');
            }
        });

        function logout() {
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('loginForm').reset();
            resetForms();
            
            // Ensure the edit modal is properly hidden on logout
            closeEditModal();
        }

        function showForm() {
            const pageSelect = document.getElementById('pageSelect').value;
            const houseRulesForm = document.getElementById('houseRulesForm');
            const instructionsForm = document.getElementById('instructionsForm');
            
            houseRulesForm.classList.add('hidden');
            instructionsForm.classList.add('hidden');
            
            if (pageSelect === 'house-rules') {
                houseRulesForm.classList.remove('hidden');
            } else if (pageSelect === 'instructions') {
                instructionsForm.classList.remove('hidden');
            }
        }

        function selectStatus(element, status) {
            document.querySelectorAll('.status-chip').forEach(chip => {
                chip.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedStatus = status;
        }

        function showRuleTypeFields() {
            const ruleType = document.getElementById('ruleType').value;
            const timeFields = document.getElementById('timeFields');
            const guestFields = document.getElementById('guestFields');
            
            timeFields.classList.add('hidden');
            guestFields.classList.add('hidden');
            
            if (ruleType === 'time') {
                timeFields.classList.remove('hidden');
            } else if (ruleType === 'guest') {
                guestFields.classList.remove('hidden');
            }
        }

        // File handling
        document.getElementById('instructionImages').addEventListener('change', function(e) {
            handleImageFiles(e.target.files);
        });

        document.getElementById('instructionVideo').addEventListener('change', function(e) {
            handleVideoFile(e.target.files[0]);
        });

        function handleImageFiles(files) {
            const imagesList = document.getElementById('imagesList');
            imagesList.innerHTML = '';
            selectedFiles = Array.from(files);
            
            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>${file.name}</span>
                    <button type="button" onclick="removeFile(${index})">Ã—</button>
                `;
                imagesList.appendChild(fileItem);
            });
        }

        function handleVideoFile(file) {
            const videoList = document.getElementById('videoList');
            videoList.innerHTML = '';
            selectedVideo = file;
            
            if (file) {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>${file.name}</span>
                    <button type="button" onclick="removeVideo()">Ã—</button>
                `;
                videoList.appendChild(fileItem);
            }
        }

        function removeFile(index) {
            selectedFiles.splice(index, 1);
            const dt = new DataTransfer();
            selectedFiles.forEach(file => dt.items.add(file));
            document.getElementById('instructionImages').files = dt.files;
            handleImageFiles(selectedFiles);
        }

        function removeVideo() {
            selectedVideo = null;
            document.getElementById('instructionVideo').value = '';
            document.getElementById('videoList').innerHTML = '';
        }

        // Form submissions
        document.getElementById('houseRuleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                icon: document.getElementById('ruleIcon').value,
                title: document.getElementById('ruleTitle').value,
                description: document.getElementById('ruleDescription').value,
                status: selectedStatus,
                statusText: document.getElementById('statusText').value,
                type: document.getElementById('ruleType').value,
                startTime: document.getElementById('startTime').value,
                endTime: document.getElementById('endTime').value,
                maxGuests: document.getElementById('maxGuests').value
            };
            
            if (!selectedStatus) {
                alert('Please select a status (Allowed/Not Allowed)');
                return;
            }
            
            addHouseRule(formData);
        });

        document.getElementById('instructionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                icon: document.getElementById('instructionIcon').value,
                title: document.getElementById('instructionTitle').value,
                steps: document.getElementById('instructionSteps').value,
                images: selectedFiles,
                video: selectedVideo
            };
            
            addInstruction(formData);
        });

        function addHouseRule(data) {
            try {
                // Create the HTML for the new rule
                let ruleHTML = `
                    <article class="rule-section">
                        <div class="rule-item">
                            <div class="rule-header">
                                <span class="rule-icon" aria-hidden="true">${data.icon}</span>
                                <span class="rule-label">${data.title}</span>`;
                
                if (data.statusText) {
                    ruleHTML += `<span class="status-chip ${data.status}">${data.statusText}</span>`;
                }
                
                ruleHTML += `</div><div class="rule-content">`;
                
                if (data.description) {
                    ruleHTML += `<p class="rule-desc">${data.description}</p>`;
                }
                
                if (data.type === 'time' && data.startTime && data.endTime) {
                    ruleHTML += `
                        <div class="time-settings">
                            <div class="time-row">
                                <span class="time-label">Start time:</span>
                                <span class="time-value">${formatTime(data.startTime)}</span>
                            </div>
                            <div class="time-row">
                                <span class="time-label">End time:</span>
                                <span class="time-value">${formatTime(data.endTime)}</span>
                            </div>
                        </div>`;
                }
                
                ruleHTML += `</div></div></article>`;
                
                // Save to localStorage for persistence
                const existingRules = JSON.parse(localStorage.getItem('houseRules') || '[]');
                existingRules.push({
                    html: ruleHTML,
                    timestamp: new Date().toISOString()
                });
                localStorage.setItem('houseRules', JSON.stringify(existingRules));
                
                showSuccessMessage();
                resetForms();
                
            } catch (error) {
                console.error('Error adding house rule:', error);
                alert('Error adding house rule. Please try again.');
            }
        }

        function addInstruction(data) {
            try {
                // Create the HTML for the new instruction
                let instructionHTML = `
                    <div class="card">
                        <div class="card-title">
                            ${data.icon} ${data.title}
                        </div>`;
                
                if (data.images && data.images.length > 0) {
                    instructionHTML += `
                        <div class="carousel">
                            <div class="checkin-gallery">`;
                    
                    data.images.forEach((image, index) => {
                        const imageName = `instruction-${Date.now()}-${index}.${image.name.split('.').pop()}`;
                        instructionHTML += `
                            <div class="gallery-item">
                                <img src="public/${imageName}" alt="Step ${index + 1}" class="gallery-image">
                                <div class="gallery-caption">Step ${index + 1}</div>
                            </div>`;
                    });
                    
                    instructionHTML += `</div></div>`;
                }
                
                instructionHTML += `
                    <div class="dropdown-container">
                        <button class="dropdown-button" onclick="toggleDropdown(this)">
                            <span class="dropdown-text">ðŸ“„ More detailed instructions</span>
                            <span class="dropdown-arrow">â–¼</span>
                        </button>
                        <div class="dropdown-content">
                            <div style="line-height: 1.6; font-size: 1rem;">
                                <p>${data.steps.replace(/\n/g, '</p><p>')}</p>`;
                
                if (data.video) {
                    const videoName = `instruction-video-${Date.now()}.${data.video.name.split('.').pop()}`;
                    instructionHTML += `
                        <h4 style="color: var(--lynx-yellow); margin-top: 20px; margin-bottom: 10px;">ðŸŽ¥ Video Guide:</h4>
                        <div style="text-align: center; margin-top: 16px;">
                            <video controls style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">
                                <source src="public/video/${videoName}" type="video/${data.video.type}">
                                Your browser does not support the video tag.
                            </video>
                        </div>`;
                }
                
                instructionHTML += `</div></div></div></div>`;
                
                // Save to localStorage for persistence
                const existingInstructions = JSON.parse(localStorage.getItem('instructions') || '[]');
                existingInstructions.push({
                    html: instructionHTML,
                    timestamp: new Date().toISOString(),
                    files: {
                        images: data.images ? Array.from(data.images).map(f => f.name) : [],
                        video: data.video ? data.video.name : null
                    }
                });
                localStorage.setItem('instructions', JSON.stringify(existingInstructions));
                
                showSuccessMessage();
                resetForms();
                
            } catch (error) {
                console.error('Error adding instruction:', error);
                alert('Error adding instruction. Please try again.');
            }
        }

        function formatTime(timeString) {
            const [hours, minutes] = timeString.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour % 12 || 12;
            return `${hour12}:${minutes} ${ampm}`;
        }

        function showSuccessMessage(message = 'Entry added successfully!') {
            const successMessage = document.getElementById('successMessage');
            successMessage.textContent = message;
            successMessage.classList.remove('hidden');
            setTimeout(() => {
                successMessage.classList.add('hidden');
            }, 3000);
        }

        function resetForms() {
            document.getElementById('houseRuleForm').reset();
            document.getElementById('instructionForm').reset();
            document.getElementById('pageSelect').value = '';
            selectedStatus = '';
            selectedFiles = [];
            selectedVideo = null;
            document.querySelectorAll('.status-chip').forEach(chip => {
                chip.classList.remove('selected');
            });
            document.getElementById('imagesList').innerHTML = '';
            document.getElementById('videoList').innerHTML = '';
            document.getElementById('houseRulesForm').classList.add('hidden');
            document.getElementById('instructionsForm').classList.add('hidden');
            document.getElementById('timeFields').classList.add('hidden');
            document.getElementById('guestFields').classList.add('hidden');
        }

        // Load and inject saved content on page load
        window.addEventListener('load', function() {
            injectSavedContent();
            
            // Ensure the edit modal is properly hidden on page load
            closeEditModal();
        });

        function injectSavedContent() {
            // This function would typically interact with the actual HTML files
            // For now, we'll just log the saved content
            const savedRules = JSON.parse(localStorage.getItem('houseRules') || '[]');
            const savedInstructions = JSON.parse(localStorage.getItem('instructions') || '[]');
            
            if (savedRules.length > 0) {
                console.log('Saved House Rules:', savedRules);
            }
            
            if (savedInstructions.length > 0) {
                console.log('Saved Instructions:', savedInstructions);
            }
        }

        // Entry management functions
        function loadExistingEntries() {
            const pageType = document.getElementById('managePageSelect').value;
            const entriesContainer = document.getElementById('entriesContainer');
            const existingEntriesList = document.getElementById('existingEntriesList');
            
            if (!pageType) {
                existingEntriesList.classList.add('hidden');
                return;
            }
            
            let entries = [];
            if (pageType === 'house-rules') {
                entries = JSON.parse(localStorage.getItem('houseRules') || '[]');
            } else if (pageType === 'instructions') {
                entries = JSON.parse(localStorage.getItem('instructions') || '[]');
            }
            
            entriesContainer.innerHTML = '';
            existingEntriesList.classList.remove('hidden');
            
            if (entries.length === 0) {
                entriesContainer.innerHTML = '<div class="no-entries">No entries found</div>';
                return;
            }
            
            entries.forEach((entry, index) => {
                const entryElement = createEntryElement(entry, index, pageType);
                entriesContainer.appendChild(entryElement);
            });
        }

        function createEntryElement(entry, index, pageType) {
            const entryDiv = document.createElement('div');
            entryDiv.className = 'entry-item';
            
            // Extract title from HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = entry.html;
            
            let title = 'Entry';
            let description = '';
            
            if (pageType === 'house-rules') {
                const ruleLabel = tempDiv.querySelector('.rule-label');
                const ruleDesc = tempDiv.querySelector('.rule-desc');
                title = ruleLabel ? ruleLabel.textContent : 'House Rule';
                description = ruleDesc ? ruleDesc.textContent.substring(0, 100) : '';
            } else if (pageType === 'instructions') {
                const cardTitle = tempDiv.querySelector('.card-title');
                title = cardTitle ? cardTitle.textContent : 'Instruction';
                description = 'Click to view details';
            }
            
            entryDiv.innerHTML = `
                <div class="entry-content">
                    <div class="entry-title">${title}</div>
                    <div class="entry-description">${description}${description.length > 100 ? '...' : ''}</div>
                    <div class="entry-meta">Added: ${new Date(entry.timestamp).toLocaleString()}</div>
                </div>
                <div class="entry-actions">
                    <button class="btn-edit" onclick="editEntry(${index}, '${pageType}')">Edit</button>
                    <button class="btn-delete" onclick="deleteEntry(${index}, '${pageType}')">Delete</button>
                </div>
            `;
            
            return entryDiv;
        }

        function editEntry(index, pageType) {
            // Validate parameters to prevent modal from showing inappropriately
            if (index === undefined || index === null || index < 0 || !pageType) {
                console.error('Invalid parameters for editEntry function');
                return;
            }
            
            currentEditIndex = index;
            currentEditType = pageType;
            
            let entries = [];
            if (pageType === 'house-rules') {
                entries = JSON.parse(localStorage.getItem('houseRules') || '[]');
            } else if (pageType === 'instructions') {
                entries = JSON.parse(localStorage.getItem('instructions') || '[]');
            }
            
            const entry = entries[index];
            if (!entry) {
                console.error('Entry not found at index:', index);
                return;
            }
            
            // Show modal and populate form
            document.getElementById('editModal').classList.remove('hidden');
            
            if (pageType === 'house-rules') {
                document.getElementById('editModalTitle').textContent = 'Edit House Rule';
                document.getElementById('editHouseRuleForm').classList.remove('hidden');
                document.getElementById('editInstructionForm').classList.add('hidden');
                populateHouseRuleEditForm(entry);
            } else if (pageType === 'instructions') {
                document.getElementById('editModalTitle').textContent = 'Edit Instruction';
                document.getElementById('editInstructionForm').classList.remove('hidden');
                document.getElementById('editHouseRuleForm').classList.add('hidden');
                populateInstructionEditForm(entry);
            }
        }

        function populateHouseRuleEditForm(entry) {
            // Parse the HTML to extract data
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = entry.html;
            
            const ruleIcon = tempDiv.querySelector('.rule-icon');
            const ruleLabel = tempDiv.querySelector('.rule-label');
            const ruleDesc = tempDiv.querySelector('.rule-desc');
            const statusChip = tempDiv.querySelector('.status-chip');
            const timeSettings = tempDiv.querySelector('.time-settings');
            
            document.getElementById('editRuleIcon').value = ruleIcon ? ruleIcon.textContent : '';
            document.getElementById('editRuleTitle').value = ruleLabel ? ruleLabel.textContent : '';
            document.getElementById('editRuleDescription').value = ruleDesc ? ruleDesc.textContent : '';
            document.getElementById('editStatusText').value = statusChip ? statusChip.textContent : '';
            
            // Set status
            if (statusChip) {
                selectedEditStatus = statusChip.classList.contains('allowed') ? 'allowed' : 'not-allowed';
                document.querySelectorAll('#editHouseRuleForm .status-chip').forEach(chip => {
                    chip.classList.remove('selected');
                });
                const targetChip = document.querySelector(`#editHouseRuleForm .status-chip.${selectedEditStatus}`);
                if (targetChip) targetChip.classList.add('selected');
            }
            
            // Set rule type
            if (timeSettings) {
                document.getElementById('editRuleType').value = 'time';
                const timeRows = timeSettings.querySelectorAll('.time-row');
                if (timeRows.length >= 2) {
                    const startTimeValue = timeRows[0].querySelector('.time-value');
                    const endTimeValue = timeRows[1].querySelector('.time-value');
                    if (startTimeValue && endTimeValue) {
                        document.getElementById('editStartTime').value = convertTo24Hour(startTimeValue.textContent);
                        document.getElementById('editEndTime').value = convertTo24Hour(endTimeValue.textContent);
                    }
                }
                showEditRuleTypeFields();
            }
        }

        function populateInstructionEditForm(entry) {
            // Parse the HTML to extract data
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = entry.html;
            
            const cardTitle = tempDiv.querySelector('.card-title');
            const dropdownContent = tempDiv.querySelector('.dropdown-content');
            
            if (cardTitle) {
                const titleText = cardTitle.textContent;
                const iconMatch = titleText.match(/^(.+?) (.+)$/);
                if (iconMatch) {
                    document.getElementById('editInstructionIcon').value = iconMatch[1];
                    document.getElementById('editInstructionTitle').value = iconMatch[2];
                }
            }
            
            if (dropdownContent) {
                const paragraphs = dropdownContent.querySelectorAll('p');
                let stepsText = '';
                paragraphs.forEach(p => {
                    if (p.textContent.trim()) {
                        stepsText += p.textContent + '\n';
                    }
                });
                document.getElementById('editInstructionSteps').value = stepsText.trim();
            }
        }

        function convertTo24Hour(time12h) {
            const [time, modifier] = time12h.split(' ');
            let [hours, minutes] = time.split(':');
            if (hours === '12') {
                hours = '00';
            }
            if (modifier === 'PM') {
                hours = parseInt(hours, 10) + 12;
            }
            return `${hours}:${minutes}`;
        }

        function selectEditStatus(element, status) {
            document.querySelectorAll('#editHouseRuleForm .status-chip').forEach(chip => {
                chip.classList.remove('selected');
            });
            element.classList.add('selected');
            selectedEditStatus = status;
        }

        function showEditRuleTypeFields() {
            const ruleType = document.getElementById('editRuleType').value;
            const timeFields = document.getElementById('editTimeFields');
            const guestFields = document.getElementById('editGuestFields');
            
            timeFields.classList.add('hidden');
            guestFields.classList.add('hidden');
            
            if (ruleType === 'time') {
                timeFields.classList.remove('hidden');
            } else if (ruleType === 'guest') {
                guestFields.classList.remove('hidden');
            }
        }

        function saveEditedEntry() {
            if (currentEditIndex === -1 || !currentEditType) return;
            
            let entries = [];
            if (currentEditType === 'house-rules') {
                entries = JSON.parse(localStorage.getItem('houseRules') || '[]');
                const formData = {
                    icon: document.getElementById('editRuleIcon').value,
                    title: document.getElementById('editRuleTitle').value,
                    description: document.getElementById('editRuleDescription').value,
                    status: selectedEditStatus,
                    statusText: document.getElementById('editStatusText').value,
                    type: document.getElementById('editRuleType').value,
                    startTime: document.getElementById('editStartTime').value,
                    endTime: document.getElementById('editEndTime').value,
                    maxGuests: document.getElementById('editMaxGuests').value
                };
                
                if (!selectedEditStatus) {
                    alert('Please select a status (Allowed/Not Allowed)');
                    return;
                }
                
                entries[currentEditIndex] = createUpdatedHouseRule(formData);
                localStorage.setItem('houseRules', JSON.stringify(entries));
                
            } else if (currentEditType === 'instructions') {
                entries = JSON.parse(localStorage.getItem('instructions') || '[]');
                const formData = {
                    icon: document.getElementById('editInstructionIcon').value,
                    title: document.getElementById('editInstructionTitle').value,
                    steps: document.getElementById('editInstructionSteps').value,
                    images: selectedEditFiles,
                    video: selectedEditVideo
                };
                
                entries[currentEditIndex] = createUpdatedInstruction(formData);
                localStorage.setItem('instructions', JSON.stringify(entries));
            }
            
            closeEditModal();
            loadExistingEntries();
            showSuccessMessage('Entry updated successfully!');
        }

        function createUpdatedHouseRule(data) {
            let ruleHTML = `
                <article class="rule-section">
                    <div class="rule-item">
                        <div class="rule-header">
                            <span class="rule-icon" aria-hidden="true">${data.icon}</span>
                            <span class="rule-label">${data.title}</span>`;
            
            if (data.statusText) {
                ruleHTML += `<span class="status-chip ${data.status}">${data.statusText}</span>`;
            }
            
            ruleHTML += `</div><div class="rule-content">`;
            
            if (data.description) {
                ruleHTML += `<p class="rule-desc">${data.description}</p>`;
            }
            
            if (data.type === 'time' && data.startTime && data.endTime) {
                ruleHTML += `
                    <div class="time-settings">
                        <div class="time-row">
                            <span class="time-label">Start time:</span>
                            <span class="time-value">${formatTime(data.startTime)}</span>
                        </div>
                        <div class="time-row">
                            <span class="time-label">End time:</span>
                            <span class="time-value">${formatTime(data.endTime)}</span>
                        </div>
                    </div>`;
            }
            
            ruleHTML += `</div></div></article>`;
            
            return {
                html: ruleHTML,
                timestamp: new Date().toISOString()
            };
        }

        function createUpdatedInstruction(data) {
            let instructionHTML = `
                <div class="card">
                    <div class="card-title">
                        ${data.icon} ${data.title}
                    </div>`;
            
            if (data.images && data.images.length > 0) {
                instructionHTML += `
                    <div class="carousel">
                        <div class="checkin-gallery">`;
                
                data.images.forEach((image, index) => {
                    const imageName = `instruction-${Date.now()}-${index}.${image.name.split('.').pop()}`;
                    instructionHTML += `
                        <div class="gallery-item">
                            <img src="public/${imageName}" alt="Step ${index + 1}" class="gallery-image">
                            <div class="gallery-caption">Step ${index + 1}</div>
                        </div>`;
                });
                
                instructionHTML += `</div></div>`;
            }
            
            instructionHTML += `
                <div class="dropdown-container">
                    <button class="dropdown-button" onclick="toggleDropdown(this)">
                        <span class="dropdown-text">ðŸ“„ More detailed instructions</span>
                        <span class="dropdown-arrow">â–¼</span>
                    </button>
                    <div class="dropdown-content">
                        <div style="line-height: 1.6; font-size: 1rem;">
                            <p>${data.steps.replace(/\n/g, '</p><p>')}</p>`;
            
            if (data.video) {
                const videoName = `instruction-video-${Date.now()}.${data.video.name.split('.').pop()}`;
                instructionHTML += `
                    <h4 style="color: var(--lynx-yellow); margin-top: 20px; margin-bottom: 10px;">ðŸŽ¥ Video Guide:</h4>
                    <div style="text-align: center; margin-top: 16px;">
                        <video controls style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);">
                            <source src="public/video/${videoName}" type="video/${data.video.type}">
                            Your browser does not support the video tag.
                        </video>
                    </div>`;
            }
            
            instructionHTML += `</div></div></div></div>`;
            
            return {
                html: instructionHTML,
                timestamp: new Date().toISOString(),
                files: {
                    images: data.images ? Array.from(data.images).map(f => f.name) : [],
                    video: data.video ? data.video.name : null
                }
            };
        }

        function deleteEntry(index, pageType) {
            if (!confirm('Are you sure you want to delete this entry? This action cannot be undone.')) {
                return;
            }
            
            let entries = [];
            if (pageType === 'house-rules') {
                entries = JSON.parse(localStorage.getItem('houseRules') || '[]');
            } else if (pageType === 'instructions') {
                entries = JSON.parse(localStorage.getItem('instructions') || '[]');
            }
            
            entries.splice(index, 1);
            
            if (pageType === 'house-rules') {
                localStorage.setItem('houseRules', JSON.stringify(entries));
            } else if (pageType === 'instructions') {
                localStorage.setItem('instructions', JSON.stringify(entries));
            }
            
            loadExistingEntries();
            showSuccessMessage('Entry deleted successfully!');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editHouseRuleForm').classList.add('hidden');
            document.getElementById('editInstructionForm').classList.add('hidden');
            
            // Reset form fields
            document.getElementById('editRuleIcon').value = '';
            document.getElementById('editRuleTitle').value = '';
            document.getElementById('editRuleDescription').value = '';
            document.getElementById('editStatusText').value = '';
            document.getElementById('editRuleType').value = 'simple';
            document.getElementById('editStartTime').value = '';
            document.getElementById('editEndTime').value = '';
            document.getElementById('editMaxGuests').value = '';
            
            document.getElementById('editInstructionIcon').value = '';
            document.getElementById('editInstructionTitle').value = '';
            document.getElementById('editInstructionSteps').value = '';
            
            // Reset status selection
            document.querySelectorAll('#editHouseRuleForm .status-chip').forEach(chip => {
                chip.classList.remove('selected');
            });
            
            selectedEditStatus = '';
            selectedEditFiles = [];
            selectedEditVideo = null;
            currentEditIndex = -1;
            currentEditType = '';
        }

                 // Handle edit form file uploads
        document.getElementById('editInstructionImages').addEventListener('change', function(e) {
            handleEditImageFiles(e.target.files);
        });

        document.getElementById('editInstructionVideo').addEventListener('change', function(e) {
            handleEditVideoFile(e.target.files[0]);
        });

        function handleEditImageFiles(files) {
            const imagesList = document.getElementById('editImagesList');
            imagesList.innerHTML = '';
            selectedEditFiles = Array.from(files);
            
            selectedEditFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>${file.name}</span>
                    <button type="button" onclick="removeEditFile(${index})">Ã—</button>
                `;
                imagesList.appendChild(fileItem);
            });
        }

        function handleEditVideoFile(file) {
            const videoList = document.getElementById('editVideoList');
            videoList.innerHTML = '';
            selectedEditVideo = file;
            
            if (file) {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>${file.name}</span>
                    <button type="button" onclick="removeEditVideo()">Ã—</button>
                `;
                videoList.appendChild(fileItem);
            }
        }

        function removeEditFile(index) {
            selectedEditFiles.splice(index, 1);
            const dt = new DataTransfer();
            selectedEditFiles.forEach(file => dt.items.add(file));
            document.getElementById('editInstructionImages').files = dt.files;
            handleEditImageFiles(selectedEditFiles);
        }

        function removeEditVideo() {
            selectedEditVideo = null;
            document.getElementById('editInstructionVideo').value = '';
            document.getElementById('editVideoList').innerHTML = '';
        }
    </script>
</body>
</html>