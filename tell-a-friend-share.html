<!-- Tell a Friend Share Button and Modal - Modular Template -->
<!-- Add this code to the end of <body> in all pages except index.html and home.html -->

<!-- Share Button (Fixed Position) -->
<button
  id="share-btn"
  class="share-btn"
  aria-label="Tell a Friend"
  title="Tell a Friend"
>
  <svg
    class="share-icon"
    viewBox="0 0 24 24"
    fill="currentColor"
  >
    <path
      d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"
    />
  </svg>
</button>

<!-- Share Modal -->
<div
  id="share-modal"
  class="share-modal"
  tabindex="-1"
  aria-modal="true"
  role="dialog"
  aria-labelledby="share-modal-title"
  aria-describedby="share-modal-description"
>
  <div class="share-modal-content">
    <div class="share-modal-header">
      <h2
        id="share-modal-title"
        class="share-modal-title"
      >
        Tell a Friend
      </h2>
      <button
        id="share-modal-close"
        class="share-modal-close"
        aria-label="Close modal"
      >
        <svg
          viewBox="0 0 24 24"
          fill="currentColor"
        >
          <path
            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
          />
        </svg>
      </button>
    </div>

    <div
      id="share-modal-description"
      class="share-modal-body"
    >
      <p class="share-modal-subtitle">
        Share your amazing stay at Lynx Apartment
        with friends and family!
      </p>

      <div class="share-options">
        <button
          class="share-option"
          data-platform="whatsapp"
          aria-label="Share on WhatsApp"
        >
          <div class="share-option-icon whatsapp">
            üì±
          </div>
          <span class="share-option-text"
            >WhatsApp</span
          >
        </button>

        <button
          class="share-option"
          data-platform="viber"
          aria-label="Share on Viber"
        >
          <div class="share-option-icon viber">
            üíú
          </div>
          <span class="share-option-text"
            >Viber</span
          >
        </button>

        <button
          class="share-option"
          data-platform="facebook"
          aria-label="Share on Facebook"
        >
          <div class="share-option-icon facebook">
            üìò
          </div>
          <span class="share-option-text"
            >Facebook</span
          >
        </button>

        <button
          class="share-option"
          data-platform="twitter"
          aria-label="Share on X (Twitter)"
        >
          <div class="share-option-icon twitter">
            üê¶
          </div>
          <span class="share-option-text"
            >X (Twitter)</span
          >
        </button>

        <button
          class="share-option"
          data-platform="instagram"
          aria-label="Share on Instagram"
        >
          <div
            class="share-option-icon instagram"
          >
            üì∑
          </div>
          <span class="share-option-text"
            >Instagram</span
          >
        </button>

        <button
          class="share-option"
          data-platform="tiktok"
          aria-label="Share on TikTok"
        >
          <div class="share-option-icon tiktok">
            üéµ
          </div>
          <span class="share-option-text"
            >TikTok</span
          >
        </button>

        <button
          class="share-option"
          data-platform="email"
          aria-label="Share via Email"
        >
          <div class="share-option-icon email">
            üìß
          </div>
          <span class="share-option-text"
            >Email</span
          >
        </button>

        <button
          class="share-option"
          data-platform="copy"
          aria-label="Copy Link"
        >
          <div class="share-option-icon copy">
            üîó
          </div>
          <span class="share-option-text"
            >Copy Link</span
          >
        </button>
      </div>

      <div class="share-message-section">
        <label
          for="share-message"
          class="share-message-label"
          >Add a personal message
          (optional):</label
        >
        <textarea
          id="share-message"
          class="share-message-input"
          placeholder="Check out this amazing apartment I'm staying at! üè†‚ú®"
          rows="3"
          maxlength="280"
        ></textarea>
        <div class="share-message-counter">
          <span id="message-counter">0</span>/280
        </div>
      </div>

      <div class="share-footer">
        <p class="share-note">
          The official Airbnb listing will always
          be included in your share.
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div
  id="share-toast"
  class="share-toast"
  role="alert"
  aria-live="polite"
>
  <span id="share-toast-message"></span>
</div>

<style>
  /* Share Button Styles */
  .share-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: linear-gradient(
      135deg,
      #ffe066 0%,
      #ffd700 100%
    );
    border: none;
    box-shadow: 0 4px 12px
      rgba(255, 224, 102, 0.3);
    cursor: pointer;
    z-index: 1000;
    transition: all 0.3s
      cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #1a1a1a;
    font-size: 24px;
  }

  .share-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px
      rgba(255, 224, 102, 0.4);
    background: linear-gradient(
      135deg,
      #ffd700 0%,
      #ffcc00 100%
    );
  }

  .share-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 8px rgba(255, 224, 102, 0.3);
  }

  .share-btn:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(255, 224, 102, 0.5),
      0 4px 12px rgba(255, 224, 102, 0.3);
  }

  .share-icon {
    width: 24px;
    height: 24px;
  }

  /* Dark mode support */
  .dark-mode .share-btn {
    background: linear-gradient(
      135deg,
      #ffe066 0%,
      #ffd700 100%
    );
    color: #1a1a1a;
  }

  /* Share Modal Styles */
  .share-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1001;
    opacity: 0;
    transition: opacity 0.3s ease;
    font-family: system-ui, -apple-system,
      BlinkMacSystemFont, "Segoe UI", Roboto,
      sans-serif;
  }

  .share-modal.show {
    display: flex;
    opacity: 1;
  }

  .share-modal-content {
    background: #ffffff;
    border-radius: 20px;
    max-width: 90vw;
    width: 480px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    transform: scale(0.9);
    transition: transform 0.3s ease;
    position: relative;
  }

  .share-modal.show .share-modal-content {
    transform: scale(1);
  }

  .share-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 24px 24px 16px 24px;
    border-bottom: 1px solid #e5e7eb;
  }

  .share-modal-title {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 700;
    color: #1f2937;
  }

  .share-modal-close {
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    color: #6b7280;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .share-modal-close:hover {
    background: #f3f4f6;
    color: #374151;
  }

  .share-modal-close svg {
    width: 20px;
    height: 20px;
  }

  .share-modal-body {
    padding: 16px 24px 24px 24px;
  }

  .share-modal-subtitle {
    margin: 0 0 20px 0;
    color: #6b7280;
    font-size: 0.95rem;
    line-height: 1.5;
  }

  /* Share Options Grid */
  .share-options {
    display: grid;
    grid-template-columns: repeat(
      auto-fit,
      minmax(100px, 1fr)
    );
    gap: 12px;
    margin-bottom: 24px;
  }

  .share-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 16px 12px;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    background: #ffffff;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
    color: inherit;
  }

  .share-option:hover {
    border-color: #ffe066;
    background: #fefce8;
    transform: translateY(-1px);
  }

  .share-option:focus {
    outline: none;
    border-color: #ffe066;
    box-shadow: 0 0 0 3px rgba(255, 224, 102, 0.3);
  }

  .share-option-icon {
    font-size: 24px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    background: #f9fafb;
  }

  .share-option-text {
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
    text-align: center;
  }

  /* Platform-specific colors */
  .share-option:hover
    .share-option-icon.whatsapp {
    background: #25d366;
    color: white;
  }

  .share-option:hover .share-option-icon.viber {
    background: #7360f2;
    color: white;
  }

  .share-option:hover
    .share-option-icon.facebook {
    background: #1877f2;
    color: white;
  }

  .share-option:hover .share-option-icon.twitter {
    background: #1da1f2;
    color: white;
  }

  .share-option:hover
    .share-option-icon.instagram {
    background: linear-gradient(
      45deg,
      #f09433,
      #e6683c,
      #dc2743,
      #cc2366,
      #bc1888
    );
    color: white;
  }

  .share-option:hover .share-option-icon.tiktok {
    background: #000000;
    color: white;
  }

  .share-option:hover .share-option-icon.email {
    background: #ea4335;
    color: white;
  }

  .share-option:hover .share-option-icon.copy {
    background: #6b7280;
    color: white;
  }

  /* Message Section */
  .share-message-section {
    margin-bottom: 20px;
  }

  .share-message-label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    color: #374151;
    font-size: 0.875rem;
  }

  .share-message-input {
    width: 100%;
    padding: 12px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-family: inherit;
    font-size: 0.875rem;
    line-height: 1.5;
    resize: vertical;
    min-height: 80px;
    transition: border-color 0.2s ease;
    box-sizing: border-box;
  }

  .share-message-input:focus {
    outline: none;
    border-color: #ffe066;
    box-shadow: 0 0 0 3px rgba(255, 224, 102, 0.2);
  }

  .share-message-counter {
    text-align: right;
    font-size: 0.75rem;
    color: #6b7280;
    margin-top: 4px;
  }

  /* Footer */
  .share-footer {
    text-align: center;
  }

  .share-note {
    margin: 0;
    font-size: 0.75rem;
    color: #6b7280;
    font-style: italic;
  }

  /* Toast Notification */
  .share-toast {
    position: fixed;
    bottom: 90px;
    right: 20px;
    background: #1f2937;
    color: #ffffff;
    padding: 12px 16px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 1002;
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.3s ease;
    max-width: 300px;
    font-size: 0.875rem;
  }

  .share-toast.show {
    opacity: 1;
    transform: translateY(0);
  }

  /* Dark Mode Support */
  .dark-mode .share-modal-content {
    background: #1f2937;
    color: #f9fafb;
  }

  .dark-mode .share-modal-title {
    color: #f9fafb;
  }

  .dark-mode .share-modal-subtitle {
    color: #9ca3af;
  }

  .dark-mode .share-option {
    background: #374151;
    border-color: #4b5563;
    color: #f9fafb;
  }

  .dark-mode .share-option:hover {
    background: #4b5563;
    border-color: #ffe066;
  }

  .dark-mode .share-option-text {
    color: #f9fafb;
  }

  .dark-mode .share-option-icon {
    background: #4b5563;
  }

  .dark-mode .share-message-label {
    color: #f9fafb;
  }

  .dark-mode .share-message-input {
    background: #374151;
    border-color: #4b5563;
    color: #f9fafb;
  }

  .dark-mode .share-message-input:focus {
    border-color: #ffe066;
  }

  .dark-mode .share-message-counter {
    color: #9ca3af;
  }

  .dark-mode .share-note {
    color: #9ca3af;
  }

  .dark-mode .share-modal-close {
    color: #9ca3af;
  }

  .dark-mode .share-modal-close:hover {
    background: #4b5563;
    color: #f9fafb;
  }

  .dark-mode .share-modal-header {
    border-bottom-color: #4b5563;
  }

  /* Mobile Responsiveness */
  @media (max-width: 600px) {
    .share-btn {
      bottom: 16px;
      right: 16px;
      width: 52px;
      height: 52px;
    }

    .share-modal-content {
      margin: 16px;
      width: calc(100vw - 32px);
      max-width: none;
    }

    .share-options {
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }

    .share-option {
      padding: 12px 8px;
    }

    .share-option-icon {
      font-size: 20px;
      width: 36px;
      height: 36px;
    }

    .share-option-text {
      font-size: 0.75rem;
    }

    .share-modal-header {
      padding: 20px 20px 12px 20px;
    }

    .share-modal-body {
      padding: 12px 20px 20px 20px;
    }

    .share-modal-title {
      font-size: 1.25rem;
    }

    .share-toast {
      bottom: 80px;
      right: 16px;
      left: 16px;
      max-width: none;
    }
  }

  /* Animation for share options */
  @keyframes shareOptionPop {
    0% {
      transform: scale(0.8);
      opacity: 0;
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  .share-option {
    animation: shareOptionPop 0.3s ease forwards;
  }

  .share-option:nth-child(1) {
    animation-delay: 0.1s;
  }
  .share-option:nth-child(2) {
    animation-delay: 0.15s;
  }
  .share-option:nth-child(3) {
    animation-delay: 0.2s;
  }
  .share-option:nth-child(4) {
    animation-delay: 0.25s;
  }
  .share-option:nth-child(5) {
    animation-delay: 0.3s;
  }
  .share-option:nth-child(6) {
    animation-delay: 0.35s;
  }
  .share-option:nth-child(7) {
    animation-delay: 0.4s;
  }
  .share-option:nth-child(8) {
    animation-delay: 0.45s;
  }
</style>

<script>
  // Tell a Friend Share Button and Modal - JavaScript
  (function () {
    "use strict";

    // Configuration
    const CONFIG = {
      AIRBNB_URL:
        "https://airbnb.com/h/lynx-apartment",
      AIRBNB_TITLE:
        "Lynx Apartment - Amazing Stay in Skopje",
      AIRBNB_DESCRIPTION:
        "Check out this beautiful apartment I'm staying at in Skopje! Perfect location, modern amenities, and amazing host.",
      DEFAULT_MESSAGE:
        "Check out this amazing apartment I'm staying at! üè†‚ú®",
      TOAST_DURATION: 3000,
    };

    // DOM Elements
    const shareBtn =
      document.getElementById("share-btn");
    const shareModal = document.getElementById(
      "share-modal"
    );
    const shareModalClose =
      document.getElementById(
        "share-modal-close"
      );
    const shareOptions =
      document.querySelectorAll(".share-option");
    const shareMessage = document.getElementById(
      "share-message"
    );
    const messageCounter =
      document.getElementById("message-counter");
    const shareToast = document.getElementById(
      "share-toast"
    );
    const shareToastMessage =
      document.getElementById(
        "share-toast-message"
      );

    // Initialize
    function init() {
      if (!shareBtn || !shareModal) return;

      // Event Listeners
      shareBtn.addEventListener(
        "click",
        openModal
      );
      shareModalClose.addEventListener(
        "click",
        closeModal
      );
      shareModal.addEventListener(
        "click",
        handleModalClick
      );
      shareOptions.forEach(option => {
        option.addEventListener(
          "click",
          handleShareOption
        );
      });

      // Message counter
      if (shareMessage && messageCounter) {
        shareMessage.addEventListener(
          "input",
          updateMessageCounter
        );
        shareMessage.addEventListener(
          "keydown",
          handleMessageKeydown
        );
      }

      // Keyboard navigation
      document.addEventListener(
        "keydown",
        handleKeydown
      );

      // Set default message
      if (shareMessage) {
        shareMessage.value =
          CONFIG.DEFAULT_MESSAGE;
        updateMessageCounter();
      }
    }

    // Modal Functions
    function openModal() {
      shareModal.classList.add("show");
      document.body.style.overflow = "hidden";
      shareModal.focus();

      // Focus first share option after animation
      setTimeout(() => {
        const firstOption = shareOptions[0];
        if (firstOption) firstOption.focus();
      }, 300);
    }

    function closeModal() {
      shareModal.classList.remove("show");
      document.body.style.overflow = "";

      // Reset message
      if (shareMessage) {
        shareMessage.value =
          CONFIG.DEFAULT_MESSAGE;
        updateMessageCounter();
      }
    }

    function handleModalClick(event) {
      if (event.target === shareModal) {
        closeModal();
      }
    }

    // Share Functions
    function handleShareOption(event) {
      const platform =
        event.currentTarget.dataset.platform;
      const message = shareMessage
        ? shareMessage.value.trim()
        : CONFIG.DEFAULT_MESSAGE;

      switch (platform) {
        case "whatsapp":
          shareWhatsApp(message);
          break;
        case "viber":
          shareViber(message);
          break;
        case "facebook":
          shareFacebook(message);
          break;
        case "twitter":
          shareTwitter(message);
          break;
        case "instagram":
          shareInstagram(message);
          break;
        case "tiktok":
          shareTikTok(message);
          break;
        case "email":
          shareEmail(message);
          break;
        case "copy":
          copyLink(message);
          break;
      }

      closeModal();
    }

    function shareWhatsApp(message) {
      const text = encodeURIComponent(
        `${message}\n\n${CONFIG.AIRBNB_URL}`
      );
      const url = `https://wa.me/?text=${text}`;
      openShareWindow(url, "WhatsApp");
    }

    function shareViber(message) {
      const text = encodeURIComponent(
        `${message}\n\n${CONFIG.AIRBNB_URL}`
      );
      const url = `https://invite.viber.com/?g=${encodeURIComponent(
        text
      )}`;
      openShareWindow(url, "Viber");
    }

    function shareFacebook(message) {
      const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(
        CONFIG.AIRBNB_URL
      )}&quote=${encodeURIComponent(message)}`;
      openShareWindow(url, "Facebook");
    }

    function shareTwitter(message) {
      const text = encodeURIComponent(
        `${message} ${CONFIG.AIRBNB_URL}`
      );
      const url = `https://twitter.com/intent/tweet?text=${text}`;
      openShareWindow(url, "X (Twitter)");
    }

    function shareInstagram(message) {
      showToast(
        "Instagram sharing requires the mobile app. Please copy the link and share manually."
      );
    }

    function shareTikTok(message) {
      showToast(
        "TikTok sharing requires the mobile app. Please copy the link and share manually."
      );
    }

    function shareEmail(message) {
      const subject = encodeURIComponent(
        CONFIG.AIRBNB_TITLE
      );
      const body = encodeURIComponent(
        `${message}\n\n${CONFIG.AIRBNB_URL}`
      );
      const url = `mailto:?subject=${subject}&body=${body}`;
      window.location.href = url;
      showToast("Email client opened");
    }

    function copyLink(message) {
      const textToCopy = `${message}\n\n${CONFIG.AIRBNB_URL}`;

      if (
        navigator.clipboard &&
        window.isSecureContext
      ) {
        navigator.clipboard
          .writeText(textToCopy)
          .then(() => {
            showToast(
              "Link copied to clipboard!"
            );
          })
          .catch(() => {
            fallbackCopyTextToClipboard(
              textToCopy
            );
          });
      } else {
        fallbackCopyTextToClipboard(textToCopy);
      }
    }

    function fallbackCopyTextToClipboard(text) {
      const textArea =
        document.createElement("textarea");
      textArea.value = text;
      textArea.style.position = "fixed";
      textArea.style.left = "-999999px";
      textArea.style.top = "-999999px";
      document.body.appendChild(textArea);
      textArea.focus();
      textArea.select();

      try {
        document.execCommand("copy");
        showToast("Link copied to clipboard!");
      } catch (err) {
        showToast("Failed to copy link");
      }

      document.body.removeChild(textArea);
    }

    function openShareWindow(url, platform) {
      const width = 600;
      const height = 400;
      const left =
        (window.innerWidth - width) / 2;
      const top =
        (window.innerHeight - height) / 2;

      const shareWindow = window.open(
        url,
        `share-${platform}`,
        `width=${width},height=${height},left=${left},top=${top},scrollbars=yes,resizable=yes`
      );

      if (shareWindow) {
        showToast(
          `${platform} share window opened`
        );
      } else {
        showToast(
          `Please allow popups to share on ${platform}`
        );
      }
    }

    // Utility Functions
    function updateMessageCounter() {
      if (!shareMessage || !messageCounter)
        return;
      const count = shareMessage.value.length;
      messageCounter.textContent = count;

      if (count > 250) {
        messageCounter.style.color = "#ef4444";
      } else if (count > 200) {
        messageCounter.style.color = "#f59e0b";
      } else {
        messageCounter.style.color = "";
      }
    }

    function handleMessageKeydown(event) {
      if (
        event.key === "Enter" &&
        event.ctrlKey
      ) {
        event.preventDefault();
        const firstOption = shareOptions[0];
        if (firstOption) firstOption.click();
      }
    }

    function handleKeydown(event) {
      if (!shareModal.classList.contains("show"))
        return;

      if (event.key === "Escape") {
        closeModal();
      }
    }

    function showToast(message) {
      if (!shareToast || !shareToastMessage)
        return;

      shareToastMessage.textContent = message;
      shareToast.classList.add("show");

      setTimeout(() => {
        shareToast.classList.remove("show");
      }, CONFIG.TOAST_DURATION);
    }

    // Initialize when DOM is ready
    if (document.readyState === "loading") {
      document.addEventListener(
        "DOMContentLoaded",
        init
      );
    } else {
      init();
    }
  })();
</script>
